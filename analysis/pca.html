<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,minimum-scale=1">

  <title>Principal Components Analysis</title>
  <meta name="description" content="        Principal Components Analysis    We used a Principle Components Analysis (PCA) in R ('prcomp' function) to integrate multiple variables and conduct a...">

  <link rel="canonical" href="http://artsengagementproject.site//analysis/pca.html">
  <link rel="alternate" type="application/rss+xml" title="The Arts Engagement Project at The University of Michigan" href="http://artsengagementproject.site//feed.xml">

  <meta property="og:url"         content="http://artsengagementproject.site//analysis/pca.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Principal Components Analysis" />
<meta property="og:description" content="        Principal Components Analysis    We used a Principle Components Analysis (PCA) in R ('prcomp' function) to integrate multiple variables and conduct a..." />
<meta property="og:image"       content="http://artsengagementproject.site//images/logo/logo.png" />

<meta name="twitter:card" content="summary">


  <script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage": "http://artsengagementproject.site//analysis/pca.html",
  "headline": "Principal Components Analysis",
  "datePublished": "2020-02-27T16:49:38-05:00",
  "dateModified": "2020-02-27T16:49:38-05:00",
  "description": "        Principal Components Analysis    We used a Principle Components Analysis (PCA) in R ('prcomp' function) to integrate multiple variables and conduct a...",
  "author": {
    "@type": "Person",
    "name": "Gabriel Harp"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Data 100 at UC Berkeley",
    "logo": {
      "@type": "ImageObject",
      "url": "http://artsengagementproject.site/",
      "width": 60,
      "height": 60
    }
  },
  "image": {
    "@type": "ImageObject",
    "url": "http://artsengagementproject.site/",
    "height": 60,
    "width": 60
  }
}

  </script>
  <link rel="stylesheet" href="/assets/css/styles.css">

  <!-- <link rel="manifest" href="/manifest.json"> -->
  <!-- <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#efae0a"> -->
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">
  <meta name="theme-color" content="#233947">

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="/images/logo/favicon.ico">

  <!-- MathJax Config -->
  <!-- Allow inline math using $ and automatically break long math lines -->
<!-- (mostly) copied from nbconvert configuration -->
<!-- https://github.com/jupyter/nbconvert/blob/master/nbconvert/templates/html/mathjax.tpl -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true,
        processEnvironments: true
    },
    // Center justify equations in code and markdown cells. Elsewhere
    // we use CSS to left justify single line equations in code cells.
    displayAlign: 'center',
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}},
        linebreaks: { automatic: true },
    },
    
});
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_HTML' async></script>


  <!-- DOM updating function -->
  <script src="/assets/js/page/dom-update.js"></script>

  <!-- Selectors for elements on the page -->
  <script src="/assets/js/page/documentSelectors.js"></script>

  <!-- Define some javascript variables that will be useful in other javascript -->
  <script>
    const site_basename = '';
  </script>

  <!-- Add AnchorJS to let headers be linked -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js" async></script>
  <script src="/assets/js/page/anchors.js" async></script>

  <!-- Include Turbolinks to make page loads fast -->
  <!-- https://github.com/turbolinks/turbolinks -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/turbolinks/5.2.0/turbolinks.js" async></script>
  <meta name="turbolinks-cache-control" content="no-cache">

  <!-- Load nbinteract for widgets -->
  

  <!-- Load Thebelab for interactive widgets -->
  <!-- Include Thebelab for interactive code if it's enabled -->



  <!-- Load the auto-generating TOC (non-async otherwise the TOC won't load w/ turbolinks) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.8.1/tocbot.min.js" async></script>
  <script src="/assets/js/page/tocbot.js"></script>

  <!-- Google analytics -->
  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '');
</script>



  <!-- Clipboard copy button -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script>

  <!-- Load custom website scripts -->
  <script src="/assets/js/scripts.js" async></script>

  <!-- Load custom user CSS and JS  -->
  <script src="/assets/custom/custom.js" async></script>
  <link rel="stylesheet" href="/assets/custom/custom.css">

  <!-- Update interact links w/ REST param, is defined in includes so we can use templates -->
  

  <!-- Lunr search code - will only be executed on the /search page -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.6/lunr.min.js" async></script>
  <script>var initQuery = function() {
  // See if we have a search box
  var searchInput = document.querySelector('input#lunr_search');
  if (searchInput === null) {
    return;
  }

  // Function to parse our lunr cache
  var idx = lunr(function () {
    this.field('title')
    this.field('excerpt')
    this.field('categories')
    this.field('tags')
    this.ref('id')

    this.pipeline.remove(lunr.trimmer)

    for (var item in store) {
      this.add({
        title: store[item].title,
        excerpt: store[item].excerpt,
        categories: store[item].categories,
        tags: store[item].tags,
        id: item
      })
    }
  });

  // Run search upon keyup
  searchInput.addEventListener('keyup', function () {
    var resultdiv = document.querySelector('#results');
    var query = document.querySelector("input#lunr_search").value.toLowerCase();
    var result =
      idx.query(function (q) {
        query.split(lunr.tokenizer.separator).forEach(function (term) {
          q.term(term, { boost: 100 })
          if(query.lastIndexOf(" ") != query.length-1){
            q.term(term, {  usePipeline: false, wildcard: lunr.Query.wildcard.TRAILING, boost: 10 })
          }
          if (term != ""){
            q.term(term, {  usePipeline: false, editDistance: 1, boost: 1 })
          }
        })
      });

      // Empty the results div
      while (resultdiv.firstChild) {
        resultdiv.removeChild(resultdiv.firstChild);
      }

    resultdiv.insertAdjacentHTML('afterbegin', '<p class="results__found">'+result.length+' Result(s) found</p>');
    for (var item in result) {
      var ref = result[item].ref;
      if(store[ref].teaser){
        var searchitem =
          '<div class="list__item">'+
            '<article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">'+
              '<h2 class="archive__item-title" itemprop="headline">'+
                '<a href="'+store[ref].url+'" rel="permalink">'+store[ref].title+'</a>'+
              '</h2>'+
              '<div class="archive__item-teaser">'+
                '<img src="'+store[ref].teaser+'" alt="">'+
              '</div>'+
              '<p class="archive__item-excerpt" itemprop="description">'+store[ref].excerpt.split(" ").splice(0,20).join(" ")+'...</p>'+
            '</article>'+
          '</div>';
      }
      else{
    	  var searchitem =
          '<div class="list__item">'+
            '<article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">'+
              '<h2 class="archive__item-title" itemprop="headline">'+
                '<a href="'+store[ref].url+'" rel="permalink">'+store[ref].title+'</a>'+
              '</h2>'+
              '<p class="archive__item-excerpt" itemprop="description">'+store[ref].excerpt.split(" ").splice(0,20).join(" ")+'...</p>'+
            '</article>'+
          '</div>';
      }
      resultdiv.insertAdjacentHTML('beforeend', searchitem);
    }
  });
};

initFunction(initQuery);
</script>

  <!-- Load JS that depends on site variables -->
  <script src="/assets/js/page/copy-button.js" async></script>

  <!-- Hide cell code -->
  <script src="/assets/js/page/hide-cell.js" async></script>

  <!-- Printing the screen -->
  <!-- Include nbinteract for interactive widgets -->
<script src="https://printjs-4de6.kxcdn.com/print.min.js" async></script>
<script>
printContent = () => {
    // MathJax displays a second version of any math for assistive devices etc.
    // This prevents double-rendering in the PDF output.
    var ignoreAssistList = [];
    assistives = document.querySelectorAll('.MathJax_Display span.MJX_Assistive_MathML').forEach((element, index) => {
        var thisId = 'MathJax-assistive-' + index.toString();
        element.setAttribute('id', thisId);
        ignoreAssistList.push(thisId)
    });

    // Print the actual content object
    printJS({
        printable: 'textbook_content',
        type: 'html',
        css: "/assets/css/styles.css",
        style: "#textbook_content {padding-top: 40px};",
        scanStyles: false,
        targetStyles: ["*"],
        ignoreElements: ignoreAssistList,
        documentTitle: "Made with Jupyter Book"
    })
};

initPrint = () => {
    document.querySelector('#interact-button-print').addEventListener('click', printContent)
}

initFunction(initPrint)
</script>

</head>

  <body>
    <!-- Include the ThebeLab config so it gets reloaded on each page -->
    <script type="text/x-thebe-config">{
    requestKernel: true,
    binderOptions: {
    repo: "YOUR-ORG/YOUR-REPO",
    ref: "gh-pages",
    },
    codeMirrorConfig: {
    theme: "abcdef",
    mode: ""
    },
    kernelOptions: {
    kernelName: "ir",
    path: "content/analysis"
    }
}
</script>

    <!-- .js-show-sidebar shows sidebar by default -->
    <div id="js-textbook" class="c-textbook js-show-sidebar">
      



<nav id="js-sidebar" class="c-textbook__sidebar">
  <a href="https://artsengagementproject.site"><img src="/images/logo/logo.png" class="textbook_logo" id="sidebar-logo" alt="textbook logo" data-turbolinks-permanent/></a>
  <h2 class="c-sidebar__title">The Arts Engagement Project at The University of Michigan</h2>
  <ul class="c-sidebar__chapters">
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/intro">
        <a class="c-sidebar__entry"
          href="/intro.html"
        >
          
          Overview
        </a>
      </li>

      
      

      

      
      

      
        

        

        <ul class="c-sidebar__sections">
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/overview/background">
              <a class="c-sidebar__entry"
                href="/overview/background.html"
              >
                
                Background
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/overview/studydesign">
              <a class="c-sidebar__entry"
                href="/overview/studydesign.html"
              >
                
                Study Design
              </a>
            </li>
            
              
              <ul class='c-sidebar__subsections u-hidden-visually'>
              
                
                
                
                
                <li class="c-sidebar__subsection" data-url="/overview/studylogistics">
                  <a class="c-sidebar__entry"
                    href="/overview/studylogistics.html"
                  >
                    
                    Study Logistics
                  </a>
                </li>
              
                
                
                
                
                <li class="c-sidebar__subsection" data-url="/overview/surveydesign">
                  <a class="c-sidebar__entry"
                    href="/overview/surveydesign.html"
                  >
                    
                    Survey Design
                  </a>
                </li>
              
                
                
                
                
                <li class="c-sidebar__subsection" data-url="/overview/datacollection">
                  <a class="c-sidebar__entry"
                    href="/overview/datacollection.html"
                  >
                    
                    Data Collection
                  </a>
                </li>
              
                
                
                
                
                <li class="c-sidebar__subsection" data-url="/overview/datadescription">
                  <a class="c-sidebar__entry"
                    href="/overview/datadescription.html"
                  >
                    
                    Data Description
                  </a>
                </li>
              
              </ul>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/overview/presentations">
              <a class="c-sidebar__entry"
                href="/overview/presentations.html"
              >
                
                Presentations
              </a>
            </li>
            
            
          
        </ul>
      

      
    
      
      
        <li class="c-sidebar__divider"></li>
        
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/insights/insights">
        <a class="c-sidebar__entry"
          href="/insights/insights.html"
        >
          
          Insights
        </a>
      </li>

      
      

      

      
      

      
        

        

        <ul class="c-sidebar__sections">
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/insights/barriers">
              <a class="c-sidebar__entry"
                href="/insights/barriers.html"
              >
                
                Barriers to Involvement
              </a>
            </li>
            
              
              <ul class='c-sidebar__subsections u-hidden-visually'>
              
                
                
                
                
                <li class="c-sidebar__subsection" data-url="/insights/barriers/tree">
                  <a class="c-sidebar__entry"
                    href="/insights/barriers/tree.html"
                  >
                    
                    Barriers - Topic Tree
                  </a>
                </li>
              
                
                
                
                
                <li class="c-sidebar__subsection" data-url="/insights/barriers/topics">
                  <a class="c-sidebar__entry"
                    href="/insights/barriers/topics.html"
                  >
                    
                    Barriers - Topic Descriptions
                  </a>
                </li>
              
                
                
                
                
                <li class="c-sidebar__subsection" data-url="/insights/barriers/dimensions">
                  <a class="c-sidebar__entry"
                    href="/insights/barriers/dimensions.html"
                  >
                    
                    Barriers - Underlying Factors
                  </a>
                </li>
              
              </ul>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/insights/othergrowth">
              <a class="c-sidebar__entry"
                href="/insights/othergrowth.html"
              >
                
                Personal Growth
              </a>
            </li>
            
              
              <ul class='c-sidebar__subsections u-hidden-visually'>
              
                
                
                
                
                <li class="c-sidebar__subsection" data-url="/insights/othergrowth/tree">
                  <a class="c-sidebar__entry"
                    href="/insights/othergrowth/tree.html"
                  >
                    
                    Growth - Topic Tree
                  </a>
                </li>
              
                
                
                
                
                <li class="c-sidebar__subsection" data-url="/insights/othergrowth/topics">
                  <a class="c-sidebar__entry"
                    href="/insights/othergrowth/topics.html"
                  >
                    
                    Growth - Topic Descriptions
                  </a>
                </li>
              
                
                
                
                
                <li class="c-sidebar__subsection" data-url="/insights/othergrowth/dimensions">
                  <a class="c-sidebar__entry"
                    href="/insights/othergrowth/dimensions.html"
                  >
                    
                    Growth - Underlying Factors
                  </a>
                </li>
              
              </ul>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/insights/feel">
              <a class="c-sidebar__entry"
                href="/insights/feel.html"
              >
                
                Emotional Impact
              </a>
            </li>
            
              
              <ul class='c-sidebar__subsections u-hidden-visually'>
              
                
                
                
                
                <li class="c-sidebar__subsection" data-url="/insights/feel/tree">
                  <a class="c-sidebar__entry"
                    href="/insights/feel/tree.html"
                  >
                    
                    Emotional Impacts - Topic Tree
                  </a>
                </li>
              
                
                
                
                
                <li class="c-sidebar__subsection" data-url="/insights/feel/topics">
                  <a class="c-sidebar__entry"
                    href="/insights/feel/topics.html"
                  >
                    
                    Emotional Impacts - Topic Descriptions
                  </a>
                </li>
              
                
                
                
                
                <li class="c-sidebar__subsection" data-url="/insights/feel/dimensions">
                  <a class="c-sidebar__entry"
                    href="/insights/feel/dimensions.html"
                  >
                    
                    Emotional Impacts - Underlying Factors
                  </a>
                </li>
              
              </ul>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/insights/development">
              <a class="c-sidebar__entry"
                href="/insights/development.html"
              >
                
                Developmental Role
              </a>
            </li>
            
              
              <ul class='c-sidebar__subsections u-hidden-visually'>
              
                
                
                
                
                <li class="c-sidebar__subsection" data-url="/insights/development/tree">
                  <a class="c-sidebar__entry"
                    href="/insights/development/tree.html"
                  >
                    
                    Developmental Role - Topic Tree
                  </a>
                </li>
              
                
                
                
                
                <li class="c-sidebar__subsection" data-url="/insights/development/topics">
                  <a class="c-sidebar__entry"
                    href="/insights/development/topics.html"
                  >
                    
                    Developmental Role - Topic Descriptions
                  </a>
                </li>
              
              </ul>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/insights/role">
              <a class="c-sidebar__entry"
                href="/insights/role.html"
              >
                
                College Experience
              </a>
            </li>
            
              
              <ul class='c-sidebar__subsections u-hidden-visually'>
              
                
                
                
                
                <li class="c-sidebar__subsection" data-url="/insights/role/tree">
                  <a class="c-sidebar__entry"
                    href="/insights/role/tree.html"
                  >
                    
                    College Experience - Topic Tree
                  </a>
                </li>
              
                
                
                
                
                <li class="c-sidebar__subsection" data-url="/insights/role/topics">
                  <a class="c-sidebar__entry"
                    href="/insights/role/topics.html"
                  >
                    
                    College Experience - Topic Descriptions
                  </a>
                </li>
              
              </ul>
            
            
          
        </ul>
      

      
    
      
      
        <li class="c-sidebar__divider"></li>
        
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/analysis/methods">
        <a class="c-sidebar__entry"
          href="/analysis/methods.html"
        >
          
          Analyses
        </a>
      </li>

      
      

      

      
      

      
        

        

        <ul class="c-sidebar__sections">
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/analysis/topics">
              <a class="c-sidebar__entry"
                href="/analysis/topics.html"
              >
                
                Topic Modeling and Interpretation
              </a>
            </li>
            
              
              <ul class='c-sidebar__subsections'>
              
                
                
                
                
                <li class="c-sidebar__subsection" data-url="/analysis/stm-workflow">
                  <a class="c-sidebar__entry"
                    href="/analysis/stm-workflow.html"
                  >
                    
                    Comprehensive STM Workflow
                  </a>
                </li>
              
              </ul>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/analysis/dictionaries">
              <a class="c-sidebar__entry"
                href="/analysis/dictionaries.html"
              >
                
                Dictionaries of Language Patterns
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/analysis/pca">
              <a class="c-sidebar__entry"
                href="/analysis/pca.html"
              >
                
                Principal Components Analysis
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/analysis/demographics">
              <a class="c-sidebar__entry"
                href="/analysis/demographics.html"
              >
                
                Demographic Analysis
              </a>
            </li>
            
            
          
        </ul>
      

      
    
      
      
        <li class="c-sidebar__divider"></li>
        
  </ul>
  <p class="sidebar_footer">Powered by <a href="https://jupyterbook.org">Jupyter Book</a></p>
</nav>

      
      <div class="c-topbar" id="top-navbar">
  <!-- We show the sidebar by default so we use .is-active -->
  <div class="c-topbar__buttons">
    <button
      id="js-sidebar-toggle"
      class="hamburger hamburger--arrowalt is-active"
    >
      <span class="hamburger-box">
        <span class="hamburger-inner"></span>
      </span>
    </button>
    <div class="buttons">
<div class="download-buttons-dropdown">
    <button id="dropdown-button-trigger" class="interact-button"><img src="/assets/images/download-solid.svg" alt="Download" /></button>
    <div class="download-buttons">
        <a href="/content/analysis/pca.ipynb" download>
        <button id="interact-button-download" class="interact-button">.ipynb</button>
        </a>
        
        <a id="interact-button-print"><button id="interact-button-download" class="interact-button">.pdf</button></a>
    </div>
</div>


  
  
  
  


</div>

  </div>
  <!-- Empty sidebar placeholder that we'll auto-fill with javascript -->
  <aside class="sidebar__right">
    <header><h4 class="nav__title"><img src="/assets/images/list-solid.svg" alt="Search" />   On this page</h4></header>
    <nav class="onthispage">
    </nav>
  </aside>
  <a href="/search.html" class="topbar-right-button" id="search-button">
    <img src="/assets/images/search-solid.svg" alt="Search" />
  </a>
</div>

      <main class="c-textbook__page" tabindex="-1">
            <div class="c-textbook__content" id="textbook_content">
                  <main class="jupyter-page">
    <div id="page-info"><div id="page-title">Principal Components Analysis</div>
</div>
    <div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We used a Principle Components Analysis (PCA) in R ('prcomp' function) to integrate multiple variables and conduct an analysis for each question and set of responses. PCA is a multivariate statistical technique that extracts important information about the inter-correlations of multiple variables and re-represents that information as new variables called principle components. These new principle components can then be used to show the similarity and graphic relationships between variables as a way of exploring the data. Because PCA condenses multiple variables into fewer dimensions, the new principle components may also be used to integrate new descriptions of the combined variables. These reified principle components may then be used as covariates to estimate relationships with other variables such as demographic factors.</p>
<p>Twenty-seven dictionary-based variables (LIWC, AIC, and Docuscope) were not relevant and were excluded from the analysis, leaving a total of 221 dictionary-based variables in the PCA. This was in addition to the measures of topic prevalence, which each had different numbers of topic variables depending on the question/response type. In order to remove variables with high numbers of 0s (no observations), we set a 0.3 maximum threshold, leaving variable columns with 70% or more observations in the analysis. The number of responses and variables included for each question in the analysis are provided in Table 1. Because of the different scales used by the different dictionaries and topic measures (for example, topic prevalence is 0-1 while AIC is measured on a scale from 1-7), the PCA was based on a correlation matrix. The data were also centered around zero and rotated.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="c1">#install.packages(&quot;corrplot&quot;)</span>
<span class="c1">#install.packages(&quot;ggplot2&quot;)</span>
<span class="c1">#install.packages(&quot;plotly&quot;)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;factoextra&quot;</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;FactoMineR&quot;</span><span class="p">)</span>

<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>   <span class="c1"># plotting;</span>
<span class="nf">library</span><span class="p">(</span><span class="n">plotly</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">haven</span><span class="p">)</span>     <span class="c1"># SPSS/.sav file import</span>
<span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>     <span class="c1"># data manipulation</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&quot;corrplot&quot;</span><span class="p">)</span><span class="c1">#</span>
<span class="nf">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span>   <span class="c1"># string manipulation</span>
<span class="nf">library</span><span class="p">(</span><span class="n">labelled</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&quot;FactoMineR&quot;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&quot;factoextra&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="c1">#data &lt;- read.csv(&#39;pcadata.csv&#39;)</span>
<span class="nf">load</span><span class="p">(</span><span class="n">file</span> <span class="o">=</span> <span class="s">&#39;merged_artsengagement.rda&#39;</span><span class="p">)</span>
<span class="nf">ls</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<ol class=list-inline>
	<li>'data'</li>
	<li>'df'</li>
</ol>

</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">data</span> <span class="o">&lt;-</span> <span class="n">df</span>
<span class="c1">#print the dimension of the dataframe</span>
<span class="nf">dim</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<ol class=list-inline>
	<li>4828</li>
	<li>7288</li>
</ol>

</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">stripnames</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">data</span> <span class="o">&lt;-</span> <span class="n">data</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">starts_with</span><span class="p">(</span><span class="n">question</span><span class="p">))</span>
    <span class="n">varnames</span> <span class="o">&lt;-</span> <span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">newnames</span> <span class="o">&lt;-</span> <span class="n">varnames</span>
    <span class="nf">for </span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="nf">length</span><span class="p">(</span><span class="n">varnames</span><span class="p">)))</span> <span class="p">{</span>
        <span class="n">newnames[i]</span> <span class="o">&lt;-</span> <span class="nf">substr</span><span class="p">(</span><span class="n">varnames[i]</span><span class="p">,</span> <span class="nf">gregexpr</span><span class="p">(</span><span class="s">&quot;\\.\\.&quot;</span><span class="p">,</span> <span class="n">varnames[i]</span><span class="p">)</span><span class="n">[[1]][1]</span><span class="m">+2</span><span class="p">,</span> <span class="nf">nchar</span><span class="p">(</span><span class="n">varnames[i]</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">newnames</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">mergeQuestion</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">if</span><span class="p">(</span><span class="nf">substr</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;_&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">question</span> <span class="o">&lt;-</span> <span class="nf">substr</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="nf">nchar</span><span class="p">(</span><span class="n">question</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="c1"># if you&#39;re aware of other prefixes, add them here</span>
    <span class="n">yrs</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;fl_&#39;</span><span class="p">,</span><span class="s">&#39;f1_&#39;</span><span class="p">,</span><span class="s">&#39;f2_&#39;</span><span class="p">,</span><span class="s">&#39;so_&#39;</span><span class="p">,</span><span class="s">&#39;jr_&#39;</span><span class="p">,</span><span class="s">&#39;sr_&#39;</span><span class="p">,</span><span class="s">&#39;sl_&#39;</span><span class="p">)</span>
    <span class="n">mergeddf</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">()</span>
    <span class="nf">for</span><span class="p">(</span><span class="n">yr</span> <span class="n">in</span> <span class="n">yrs</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">qyr</span> <span class="o">&lt;-</span> <span class="nf">paste0</span><span class="p">(</span><span class="n">yr</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span>
        <span class="nf">if</span><span class="p">(</span><span class="n">data</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">starts_with</span><span class="p">(</span><span class="n">qyr</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="n">ncol</span> <span class="o">==</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span> <span class="n">next</span> <span class="p">}</span>
        <span class="n">tempdf</span> <span class="o">&lt;-</span> <span class="nf">stripnames</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">qyr</span><span class="p">)</span>
        <span class="nf">names</span><span class="p">(</span><span class="n">tempdf</span><span class="p">)</span><span class="n">[1]</span> <span class="o">&lt;-</span> <span class="n">question</span>
        <span class="n">mergeddf</span> <span class="o">&lt;-</span> <span class="nf">bind_rows</span><span class="p">(</span><span class="n">mergeddf</span><span class="p">,</span> <span class="n">tempdf</span><span class="p">)</span>        
    <span class="p">}</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">mergeddf</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">stripVars</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">#remove irrelavant variables</span>
    <span class="n">removenames</span> <span class="o">&lt;-</span> <span class="nf">names</span><span class="p">(</span><span class="n">data</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="s">&quot;AIC..Words|AIC..IC_Differentiation|AIC..IC_Integration|AIC..DIAL_Differentiation|AIC..DIAL_Integration|AIC..ELAB_Differentiation|AIC..ELAB_Integration|docuscope..OralCues|docuscope..DialogCues|docuscope..XWordTokens|docuscope..XPunctuationTokens|docuscope..XTokens|LIWC..WC|LIWC..Sixltr|LIWC..Dic|LIWC..WPS|LIWC..swear|LIWC..netspeak|LIWC..assent|LIWC..nonflu|LIWC..filler|LIWC..AllPunc|LIWC..Period|LIWC..Comma|LIWC..Colon|LIWC..SemiC|LIWC..QMark|LIWC..Exclam|LIWC..Dash|LIWC..Quote|LIWC..Apostro|LIWC..Parenth|LIWC..OtherP&quot;</span><span class="p">)))</span>
    <span class="n">data</span> <span class="o">&lt;-</span> <span class="n">data[</span> <span class="p">,</span> <span class="o">!</span><span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">%in%</span> <span class="n">removenames]</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">#example input for parameter question: &quot;sr_career&quot;</span>
<span class="c1">#threshold: set the threshold for cos2. only variables with cos2&gt; threshold will be kept in biplots</span>
<span class="c1">#percent: set the percentage of 0 in a column; columns with percentage of 0 values &gt; percent will be removed</span>
<span class="n">pca_biplot</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="n">threshold</span><span class="p">,</span><span class="n">percent</span><span class="p">)</span> <span class="p">{</span>
    
    
    <span class="nf">if</span><span class="p">(</span><span class="nf">substr</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;_&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">question</span> <span class="o">&lt;-</span> <span class="nf">substr</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="nf">nchar</span><span class="p">(</span><span class="n">question</span><span class="p">))</span>
    <span class="p">}</span>
    
    <span class="c1"># select columns relevant to the question</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="nf">mergeQuestion</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">stripVars</span>
    <span class="nf">print</span><span class="p">(</span><span class="nf">dim</span><span class="p">(</span><span class="n">data_subset</span><span class="p">))</span>
    <span class="c1">#create file for eigenvales and output</span>
    <span class="n">eigfile</span> <span class="o">&lt;-</span> <span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_eigenvalues.txt&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="nf">sink</span><span class="p">(</span><span class="n">eigfile</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>       
    
    <span class="c1">#remove rows with no response</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset</span><span class="nf">[complete.cases</span><span class="p">(</span><span class="n">data_subset</span><span class="p">),</span><span class="n">]</span>
    <span class="nf">print</span><span class="p">(</span><span class="nf">dim</span><span class="p">(</span><span class="n">data_subset</span><span class="p">))</span>
    <span class="c1"># replace NULL with 0</span>
    <span class="c1"># this shouldnt be necessary -- investigate if so</span>
    <span class="c1"># data_subset[is.na(data_subset)] &lt;- 0</span>

    <span class="c1">#remove columns with percentage of 0 values &gt; percent </span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset[</span> <span class="nf">lapply</span><span class="p">(</span> <span class="n">data_subset</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="m">0</span><span class="p">)</span> <span class="o">/</span> <span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="n">percent</span> <span class="n">]</span>

    <span class="nf">print</span><span class="p">(</span><span class="nf">dim</span><span class="p">(</span><span class="n">data_subset</span><span class="p">))</span>

    <span class="nf">print</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">data_subset</span><span class="p">))</span>

    <span class="c1">#scale all the variables</span>
    <span class="n">data_subset[</span><span class="p">,</span> <span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="nf">scale</span><span class="p">(</span><span class="n">data_subset[</span><span class="p">,</span> <span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="n">]</span><span class="p">)</span>

    <span class="c1">#create new dataframe pcadata to store scaled variables</span>
    <span class="n">pcadata</span><span class="o">&lt;-</span><span class="n">data_subset[</span><span class="p">,</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="n">]</span>



    <span class="c1">#remove columns that only have NULL; columns that only have 0 after scaling will become NULL</span>
    <span class="n">pcadata2</span><span class="o">=</span><span class="nf">Filter</span><span class="p">(</span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">!</span><span class="nf">all</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">pcadata</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="nf">dim</span><span class="p">(</span><span class="n">pcadata2</span><span class="p">))</span>


    <span class="c1">#fit PCA uses correlatio matrix, rotation, centered</span>
    <span class="n">pca.fit</span> <span class="o">&lt;-</span> <span class="nf">prcomp</span><span class="p">(</span><span class="n">pcadata2</span><span class="p">,</span> <span class="n">retx</span><span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
    <span class="n">eig.val</span> <span class="o">&lt;-</span> <span class="nf">get_eigenvalue</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">)</span>


    <span class="c1">#get variable contributions</span>
    <span class="n">var</span> <span class="o">&lt;-</span> <span class="nf">get_pca_var</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">)</span>
    <span class="c1">#print(var$contrib)</span>
    <span class="c1">#print(var$coord)</span>
    <span class="c1">#print(pca.fit)</span>

 
    <span class="c1"># Print Eigenvalues and variable contributions and close sink</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">eig.val</span><span class="p">)</span>

    <span class="nf">sink</span><span class="p">(</span><span class="n">append</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;message&quot;</span><span class="p">)</span>
    <span class="nf">sink</span><span class="p">()</span>

    <span class="c1"># Export into a TXT file</span>
    <span class="nf">write.infile</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_pca_results.txt&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;\t&quot;</span><span class="p">)</span>


    <span class="c1">#print screeplot              </span>
    <span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_screeplot.pdf&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>    
    <span class="n">screeplot</span><span class="o">=</span><span class="nf">fviz_eig</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">,</span> <span class="n">addlabels</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">ylim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">50</span><span class="p">))</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">screeplot</span><span class="p">)</span>
    <span class="nf">dev.off</span><span class="p">()</span>

    <span class="c1">#make biplot for PC1&amp;2               </span>
    <span class="n">p12</span><span class="o">=</span><span class="nf">fviz_pca_var</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span> <span class="n">col.var</span> <span class="o">=</span> <span class="s">&quot;cos2&quot;</span><span class="p">,</span> <span class="n">alpha.var</span><span class="o">=</span><span class="s">&quot;cos2&quot;</span><span class="p">,</span> <span class="n">select.var</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">cos2</span> <span class="o">=</span> <span class="n">threshold</span><span class="p">),</span>
                 <span class="n">gradient.cols</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;goldenrod1&quot;</span><span class="p">,</span> <span class="s">&quot;firebrick2&quot;</span><span class="p">,</span> <span class="s">&quot;navy&quot;</span><span class="p">),</span> 
                 <span class="n">repel</span> <span class="o">=</span> <span class="kc">TRUE</span> <span class="c1"># Avoid text overlapping</span>
                 <span class="p">)</span><span class="o">+</span> <span class="nf">xlim</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">ylim </span><span class="p">(</span><span class="m">-1</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
                    
                    
    <span class="c1">#make biplot for PC3&amp;4              </span>
    <span class="n">p34</span><span class="o">=</span><span class="nf">fviz_pca_var</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">),</span> <span class="n">col.var</span> <span class="o">=</span> <span class="s">&quot;cos2&quot;</span><span class="p">,</span> <span class="n">alpha.var</span><span class="o">=</span><span class="s">&quot;cos2&quot;</span><span class="p">,</span> <span class="n">select.var</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">cos2</span> <span class="o">=</span> <span class="n">threshold</span><span class="p">),</span>
                 <span class="n">gradient.cols</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;goldenrod1&quot;</span><span class="p">,</span> <span class="s">&quot;firebrick2&quot;</span><span class="p">,</span> <span class="s">&quot;navy&quot;</span><span class="p">),</span> 
                 <span class="n">repel</span> <span class="o">=</span> <span class="kc">TRUE</span> <span class="c1"># Avoid text overlapping</span>
                 <span class="p">)</span><span class="o">+</span> <span class="nf">xlim</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">ylim </span><span class="p">(</span><span class="m">-1</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>

    <span class="c1">#print biplot                </span>
    <span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_biplot12.pdf&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">p12</span><span class="p">)</span>
    <span class="nf">dev.off</span><span class="p">()</span>
                    
    <span class="c1">#print biplot                </span>
    <span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_biplot34.pdf&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">p34</span><span class="p">)</span>
    <span class="nf">dev.off</span><span class="p">()</span>

    <span class="c1">#print charts of variable contrib and cos2</span>

    <span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_corr_cos2_viz.pdf&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="n">corrcos2viz</span> <span class="o">&lt;-</span> <span class="nf">corrplot</span><span class="p">(</span><span class="n">var</span><span class="o">$</span><span class="n">cos2</span><span class="p">,</span> <span class="n">is.corr</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">tl.cex</span> <span class="o">=</span> <span class="m">.5</span><span class="p">)</span>   
    <span class="nf">print</span><span class="p">(</span><span class="n">corrcos2viz</span><span class="p">)</span>
    <span class="nf">dev.off</span><span class="p">()</span>

    <span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_corr_contrib_viz.pdf&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="n">corrcontribviz</span> <span class="o">&lt;-</span> <span class="nf">corrplot</span><span class="p">(</span><span class="n">var</span><span class="o">$</span><span class="n">contrib</span><span class="p">,</span> <span class="n">is.corr</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">tl.cex</span> <span class="o">=</span> <span class="m">.5</span><span class="p">)</span>    
    <span class="nf">print</span><span class="p">(</span><span class="n">corrcontribviz</span><span class="p">)</span>
    <span class="nf">dev.off</span><span class="p">()</span>


    <span class="c1"># Contributions of variables to PC1</span>
    <span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_contributionPC1.pdf&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="n">c1</span><span class="o">=</span><span class="nf">fviz_contrib</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">,</span> <span class="n">choice</span> <span class="o">=</span> <span class="s">&quot;var&quot;</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>              
    <span class="nf">dev.off</span><span class="p">()</span>
    <span class="c1"># Contributions of variables to PC2</span>
    <span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_contributionPC2.pdf&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="n">c2</span><span class="o">=</span><span class="nf">fviz_contrib</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">,</span> <span class="n">choice</span> <span class="o">=</span> <span class="s">&quot;var&quot;</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
    <span class="nf">dev.off</span><span class="p">()</span>
    <span class="c1"># Contributions of variables to PC3</span>
    <span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_contributionPC3.pdf&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="n">c3</span><span class="o">=</span><span class="nf">fviz_contrib</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">,</span> <span class="n">choice</span> <span class="o">=</span> <span class="s">&quot;var&quot;</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">c3</span><span class="p">)</span>
    <span class="nf">dev.off</span><span class="p">()</span>
    <span class="c1"># Contributions of variables to PC4</span>
    <span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_contributionPC4.pdf&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="n">c4</span><span class="o">=</span><span class="nf">fviz_contrib</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">,</span> <span class="n">choice</span> <span class="o">=</span> <span class="s">&quot;var&quot;</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="m">4</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">c4</span><span class="p">)</span>
    <span class="nf">dev.off</span><span class="p">()</span>
    <span class="c1"># Contributions of variables to PC5</span>
    <span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_contributionPC5.pdf&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="n">c5</span><span class="o">=</span><span class="nf">fviz_contrib</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">,</span> <span class="n">choice</span> <span class="o">=</span> <span class="s">&quot;var&quot;</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="m">5</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">c5</span><span class="p">)</span>
    <span class="nf">dev.off</span><span class="p">()</span>



    <span class="c1">###### interactive pca plot</span>
    <span class="c1">#add text response back to pcadata2</span>
    <span class="n">pcadata2</span><span class="o">$</span><span class="n">text</span><span class="o">&lt;-</span><span class="n">data_subset[[question]]</span>
    <span class="n">res.pca</span> <span class="o">&lt;-</span> <span class="nf">PCA</span><span class="p">(</span><span class="n">pcadata2[</span><span class="p">,</span><span class="o">!</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">pcadata2</span><span class="p">)</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;text&quot;</span><span class="p">))</span><span class="n">]</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>

    <span class="c1">#make biplot with individual dots</span>
    <span class="n">test2</span><span class="o">&lt;-</span><span class="nf">fviz_pca_biplot</span><span class="p">(</span><span class="n">res.pca</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span> <span class="n">geom</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;point&#39;</span><span class="p">,</span><span class="s">&#39;text&#39;</span><span class="p">),</span> <span class="n">col.ind</span> <span class="o">=</span> <span class="s">&quot;light blue&quot;</span><span class="p">,</span>
                    <span class="n">pointshape</span> <span class="o">=</span> <span class="m">19</span><span class="p">,</span> <span class="n">pointsize</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span><span class="n">alpha.ind</span> <span class="o">=</span> <span class="m">0.3</span><span class="p">,</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;var&quot;</span><span class="p">,</span> 
                    <span class="n">alpha.var</span> <span class="o">=</span><span class="s">&quot;cos2&quot;</span><span class="p">,</span> <span class="n">select.var</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">cos2</span> <span class="o">=</span> <span class="n">threshold</span><span class="p">),</span>
                     <span class="n">col.var</span> <span class="o">=</span> <span class="s">&quot;cos2&quot;</span><span class="p">,</span><span class="n">gradient.cols</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">)</span>

                    <span class="p">)</span>
                    
                    
      <span class="c1">#labs(fill = &quot;identity&quot;)# Change legend title</span>

    <span class="c1">#add hover text</span>
    <span class="n">mytext</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">pcadata2</span><span class="o">$</span><span class="n">text</span><span class="p">)</span> 
    <span class="n">pp</span><span class="o">=</span><span class="nf">ggplotly</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">test2</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="m">800</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="m">800</span><span class="p">)</span>
    <span class="n">ppp</span><span class="o">=</span><span class="nf">style</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">mytext</span><span class="p">,</span><span class="n">hoverinfo</span><span class="o">=</span><span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">traces</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">))</span>
    <span class="n">htmlwidgets</span><span class="o">::</span><span class="nf">saveWidget</span><span class="p">(</span><span class="nf">as_widget</span><span class="p">(</span><span class="n">ppp</span><span class="p">),</span> <span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_plotly12.html&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
                    
    <span class="n">test3</span><span class="o">&lt;-</span><span class="nf">fviz_pca_biplot</span><span class="p">(</span><span class="n">res.pca</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">),</span> <span class="n">geom</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;point&#39;</span><span class="p">,</span><span class="s">&#39;text&#39;</span><span class="p">),</span> <span class="n">col.ind</span> <span class="o">=</span> <span class="s">&quot;light blue&quot;</span><span class="p">,</span>
                    <span class="n">pointshape</span> <span class="o">=</span> <span class="m">19</span><span class="p">,</span> <span class="n">pointsize</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span><span class="n">alpha.ind</span> <span class="o">=</span> <span class="m">0.3</span><span class="p">,</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;var&quot;</span><span class="p">,</span> 
                    <span class="n">alpha.var</span> <span class="o">=</span><span class="s">&quot;cos2&quot;</span><span class="p">,</span> <span class="n">select.var</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">cos2</span> <span class="o">=</span> <span class="n">threshold</span><span class="p">),</span>
                     <span class="n">col.var</span> <span class="o">=</span> <span class="s">&quot;cos2&quot;</span><span class="p">,</span><span class="n">gradient.cols</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">)</span>

                    <span class="p">)</span>
                    
    <span class="c1">#add hover text</span>
    <span class="n">mytext</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">pcadata2</span><span class="o">$</span><span class="n">text</span><span class="p">)</span> 
    <span class="n">pp</span><span class="o">=</span><span class="nf">ggplotly</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">test3</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="m">800</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="m">800</span><span class="p">)</span>
    <span class="n">ppp</span><span class="o">=</span><span class="nf">style</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">mytext</span><span class="p">,</span><span class="n">hoverinfo</span><span class="o">=</span><span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">traces</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">))</span>
    <span class="n">htmlwidgets</span><span class="o">::</span><span class="nf">saveWidget</span><span class="p">(</span><span class="nf">as_widget</span><span class="p">(</span><span class="n">ppp</span><span class="p">),</span> <span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_plotly34.html&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="c1">#example input for parameter question: &quot;career&quot;</span>
<span class="c1">#1st is threshold: set the threshold for cos2. only variables with cos2&gt; threshold will be kept in biplots</span>
<span class="c1">#2nd is percent: set the percentage of 0 in a column; columns with percentage of 0 values &gt; percent will be removedpca_biplot(&#39;barriers&#39;,0.3,0.4)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;career&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;development&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;othergrowth&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;society&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;role&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;barriers&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;feel&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;definition&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;aftercollege4&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;behavior2&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;change&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;childhood2&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

 


    </main>
    
            </div>
            <div class="c-textbook__footer" id="textbook_footer">
              
<nav class="c-page__nav">
  
    
    

    <a id="js-page__nav__prev" class="c-page__nav__prev" href="/analysis/dictionaries.html">
       <span class="u-margin-right-tiny"></span> Dictionaries of Language Patterns
    </a>
  

  
    

    
    <a id="js-page__nav__next" class="c-page__nav__next" href="/analysis/demographics.html">
      Demographic Analysis <span class="u-margin-right-tiny"></span> 
    </a>
  
</nav>

              <footer>
  <p class="footer">This page is created and maintained by <a href="https://github.com/gharp">Gabriel Harp</a></p>
</footer>

            </div>

        </div>
      </main>
    </div>
  </body>
</html>
