---
interact_link: content/analysis/pca.ipynb
kernel_name: ir
kernel_path: content/analysis
has_widgets: false
title: |-
  Principal Components Analysis
pagenum: 31
prev_page:
  url: /analysis/dictionaries.html
next_page:
  url: /analysis/demographics.html
suffix: .ipynb
search: variables components analysis used principle pca new topic multiple question based different integrate set responses information relationships data because also dictionary aic leaving measures prevalence numbers observations principal r prcomp function conduct multivariate statistical technique extracts important inter correlations re represents called show similarity graphic between exploring condenses into fewer dimensions descriptions combined reified covariates estimate such demographic factors twenty seven liwc docuscope not relevant excluded total addition depending response type order remove high s maximum threshold variable columns included provided table scales dictionaries example while measured scale correlation matrix centered around zero rotated

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

    <main class="jupyter-page">
    <div id="page-info"><div id="page-title">Principal Components Analysis</div>
</div>
    <div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We used a Principle Components Analysis (PCA) in R ('prcomp' function) to integrate multiple variables and conduct an analysis for each question and set of responses. PCA is a multivariate statistical technique that extracts important information about the inter-correlations of multiple variables and re-represents that information as new variables called principle components. These new principle components can then be used to show the similarity and graphic relationships between variables as a way of exploring the data. Because PCA condenses multiple variables into fewer dimensions, the new principle components may also be used to integrate new descriptions of the combined variables. These reified principle components may then be used as covariates to estimate relationships with other variables such as demographic factors.</p>
<p>Twenty-seven dictionary-based variables (LIWC, AIC, and Docuscope) were not relevant and were excluded from the analysis, leaving a total of 221 dictionary-based variables in the PCA. This was in addition to the measures of topic prevalence, which each had different numbers of topic variables depending on the question/response type. In order to remove variables with high numbers of 0s (no observations), we set a 0.3 maximum threshold, leaving variable columns with 70% or more observations in the analysis. The number of responses and variables included for each question in the analysis are provided in Table 1. Because of the different scales used by the different dictionaries and topic measures (for example, topic prevalence is 0-1 while AIC is measured on a scale from 1-7), the PCA was based on a correlation matrix. The data were also centered around zero and rotated.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="c1">#install.packages(&quot;corrplot&quot;)</span>
<span class="c1">#install.packages(&quot;ggplot2&quot;)</span>
<span class="c1">#install.packages(&quot;plotly&quot;)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;factoextra&quot;</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;FactoMineR&quot;</span><span class="p">)</span>

<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>   <span class="c1"># plotting;</span>
<span class="nf">library</span><span class="p">(</span><span class="n">plotly</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">haven</span><span class="p">)</span>     <span class="c1"># SPSS/.sav file import</span>
<span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>     <span class="c1"># data manipulation</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&quot;corrplot&quot;</span><span class="p">)</span><span class="c1">#</span>
<span class="nf">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span>   <span class="c1"># string manipulation</span>
<span class="nf">library</span><span class="p">(</span><span class="n">labelled</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&quot;FactoMineR&quot;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&quot;factoextra&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="c1">#data &lt;- read.csv(&#39;pcadata.csv&#39;)</span>
<span class="nf">load</span><span class="p">(</span><span class="n">file</span> <span class="o">=</span> <span class="s">&#39;merged_artsengagement.rda&#39;</span><span class="p">)</span>
<span class="nf">ls</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<ol class=list-inline>
	<li>'data'</li>
	<li>'df'</li>
</ol>

</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">data</span> <span class="o">&lt;-</span> <span class="n">df</span>
<span class="c1">#print the dimension of the dataframe</span>
<span class="nf">dim</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<ol class=list-inline>
	<li>4828</li>
	<li>7288</li>
</ol>

</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">stripnames</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">data</span> <span class="o">&lt;-</span> <span class="n">data</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">starts_with</span><span class="p">(</span><span class="n">question</span><span class="p">))</span>
    <span class="n">varnames</span> <span class="o">&lt;-</span> <span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">newnames</span> <span class="o">&lt;-</span> <span class="n">varnames</span>
    <span class="nf">for </span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="nf">length</span><span class="p">(</span><span class="n">varnames</span><span class="p">)))</span> <span class="p">{</span>
        <span class="n">newnames[i]</span> <span class="o">&lt;-</span> <span class="nf">substr</span><span class="p">(</span><span class="n">varnames[i]</span><span class="p">,</span> <span class="nf">gregexpr</span><span class="p">(</span><span class="s">&quot;\\.\\.&quot;</span><span class="p">,</span> <span class="n">varnames[i]</span><span class="p">)</span><span class="n">[[1]][1]</span><span class="m">+2</span><span class="p">,</span> <span class="nf">nchar</span><span class="p">(</span><span class="n">varnames[i]</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">newnames</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">mergeQuestion</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">if</span><span class="p">(</span><span class="nf">substr</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;_&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">question</span> <span class="o">&lt;-</span> <span class="nf">substr</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="nf">nchar</span><span class="p">(</span><span class="n">question</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="c1"># if you&#39;re aware of other prefixes, add them here</span>
    <span class="n">yrs</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;fl_&#39;</span><span class="p">,</span><span class="s">&#39;f1_&#39;</span><span class="p">,</span><span class="s">&#39;f2_&#39;</span><span class="p">,</span><span class="s">&#39;so_&#39;</span><span class="p">,</span><span class="s">&#39;jr_&#39;</span><span class="p">,</span><span class="s">&#39;sr_&#39;</span><span class="p">,</span><span class="s">&#39;sl_&#39;</span><span class="p">)</span>
    <span class="n">mergeddf</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">()</span>
    <span class="nf">for</span><span class="p">(</span><span class="n">yr</span> <span class="n">in</span> <span class="n">yrs</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">qyr</span> <span class="o">&lt;-</span> <span class="nf">paste0</span><span class="p">(</span><span class="n">yr</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span>
        <span class="nf">if</span><span class="p">(</span><span class="n">data</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">starts_with</span><span class="p">(</span><span class="n">qyr</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="n">ncol</span> <span class="o">==</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span> <span class="n">next</span> <span class="p">}</span>
        <span class="n">tempdf</span> <span class="o">&lt;-</span> <span class="nf">stripnames</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">qyr</span><span class="p">)</span>
        <span class="nf">names</span><span class="p">(</span><span class="n">tempdf</span><span class="p">)</span><span class="n">[1]</span> <span class="o">&lt;-</span> <span class="n">question</span>
        <span class="n">mergeddf</span> <span class="o">&lt;-</span> <span class="nf">bind_rows</span><span class="p">(</span><span class="n">mergeddf</span><span class="p">,</span> <span class="n">tempdf</span><span class="p">)</span>        
    <span class="p">}</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">mergeddf</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">stripVars</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">#remove irrelavant variables</span>
    <span class="n">removenames</span> <span class="o">&lt;-</span> <span class="nf">names</span><span class="p">(</span><span class="n">data</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="s">&quot;AIC..Words|AIC..IC_Differentiation|AIC..IC_Integration|AIC..DIAL_Differentiation|AIC..DIAL_Integration|AIC..ELAB_Differentiation|AIC..ELAB_Integration|docuscope..OralCues|docuscope..DialogCues|docuscope..XWordTokens|docuscope..XPunctuationTokens|docuscope..XTokens|LIWC..WC|LIWC..Sixltr|LIWC..Dic|LIWC..WPS|LIWC..swear|LIWC..netspeak|LIWC..assent|LIWC..nonflu|LIWC..filler|LIWC..AllPunc|LIWC..Period|LIWC..Comma|LIWC..Colon|LIWC..SemiC|LIWC..QMark|LIWC..Exclam|LIWC..Dash|LIWC..Quote|LIWC..Apostro|LIWC..Parenth|LIWC..OtherP&quot;</span><span class="p">)))</span>
    <span class="n">data</span> <span class="o">&lt;-</span> <span class="n">data[</span> <span class="p">,</span> <span class="o">!</span><span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">%in%</span> <span class="n">removenames]</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">#example input for parameter question: &quot;sr_career&quot;</span>
<span class="c1">#threshold: set the threshold for cos2. only variables with cos2&gt; threshold will be kept in biplots</span>
<span class="c1">#percent: set the percentage of 0 in a column; columns with percentage of 0 values &gt; percent will be removed</span>
<span class="n">pca_biplot</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="n">threshold</span><span class="p">,</span><span class="n">percent</span><span class="p">)</span> <span class="p">{</span>
    
    
    <span class="nf">if</span><span class="p">(</span><span class="nf">substr</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;_&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">question</span> <span class="o">&lt;-</span> <span class="nf">substr</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="nf">nchar</span><span class="p">(</span><span class="n">question</span><span class="p">))</span>
    <span class="p">}</span>
    
    <span class="c1"># select columns relevant to the question</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="nf">mergeQuestion</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">stripVars</span>
    <span class="nf">print</span><span class="p">(</span><span class="nf">dim</span><span class="p">(</span><span class="n">data_subset</span><span class="p">))</span>
    <span class="c1">#create file for eigenvales and output</span>
    <span class="n">eigfile</span> <span class="o">&lt;-</span> <span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_eigenvalues.txt&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="nf">sink</span><span class="p">(</span><span class="n">eigfile</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>       
    
    <span class="c1">#remove rows with no response</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset</span><span class="nf">[complete.cases</span><span class="p">(</span><span class="n">data_subset</span><span class="p">),</span><span class="n">]</span>
    <span class="nf">print</span><span class="p">(</span><span class="nf">dim</span><span class="p">(</span><span class="n">data_subset</span><span class="p">))</span>
    <span class="c1"># replace NULL with 0</span>
    <span class="c1"># this shouldnt be necessary -- investigate if so</span>
    <span class="c1"># data_subset[is.na(data_subset)] &lt;- 0</span>

    <span class="c1">#remove columns with percentage of 0 values &gt; percent </span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset[</span> <span class="nf">lapply</span><span class="p">(</span> <span class="n">data_subset</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="m">0</span><span class="p">)</span> <span class="o">/</span> <span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="n">percent</span> <span class="n">]</span>

    <span class="nf">print</span><span class="p">(</span><span class="nf">dim</span><span class="p">(</span><span class="n">data_subset</span><span class="p">))</span>

    <span class="nf">print</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">data_subset</span><span class="p">))</span>

    <span class="c1">#scale all the variables</span>
    <span class="n">data_subset[</span><span class="p">,</span> <span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="nf">scale</span><span class="p">(</span><span class="n">data_subset[</span><span class="p">,</span> <span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="n">]</span><span class="p">)</span>

    <span class="c1">#create new dataframe pcadata to store scaled variables</span>
    <span class="n">pcadata</span><span class="o">&lt;-</span><span class="n">data_subset[</span><span class="p">,</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="n">]</span>



    <span class="c1">#remove columns that only have NULL; columns that only have 0 after scaling will become NULL</span>
    <span class="n">pcadata2</span><span class="o">=</span><span class="nf">Filter</span><span class="p">(</span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">!</span><span class="nf">all</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">pcadata</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="nf">dim</span><span class="p">(</span><span class="n">pcadata2</span><span class="p">))</span>


    <span class="c1">#fit PCA uses correlatio matrix, rotation, centered</span>
    <span class="n">pca.fit</span> <span class="o">&lt;-</span> <span class="nf">prcomp</span><span class="p">(</span><span class="n">pcadata2</span><span class="p">,</span> <span class="n">retx</span><span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
    <span class="n">eig.val</span> <span class="o">&lt;-</span> <span class="nf">get_eigenvalue</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">)</span>


    <span class="c1">#get variable contributions</span>
    <span class="n">var</span> <span class="o">&lt;-</span> <span class="nf">get_pca_var</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">)</span>
    <span class="c1">#print(var$contrib)</span>
    <span class="c1">#print(var$coord)</span>
    <span class="c1">#print(pca.fit)</span>

 
    <span class="c1"># Print Eigenvalues and variable contributions and close sink</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">eig.val</span><span class="p">)</span>

    <span class="nf">sink</span><span class="p">(</span><span class="n">append</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;message&quot;</span><span class="p">)</span>
    <span class="nf">sink</span><span class="p">()</span>

    <span class="c1"># Export into a TXT file</span>
    <span class="nf">write.infile</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_pca_results.txt&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;\t&quot;</span><span class="p">)</span>


    <span class="c1">#print screeplot              </span>
    <span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_screeplot.pdf&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>    
    <span class="n">screeplot</span><span class="o">=</span><span class="nf">fviz_eig</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">,</span> <span class="n">addlabels</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">ylim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">50</span><span class="p">))</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">screeplot</span><span class="p">)</span>
    <span class="nf">dev.off</span><span class="p">()</span>

    <span class="c1">#make biplot for PC1&amp;2               </span>
    <span class="n">p12</span><span class="o">=</span><span class="nf">fviz_pca_var</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span> <span class="n">col.var</span> <span class="o">=</span> <span class="s">&quot;cos2&quot;</span><span class="p">,</span> <span class="n">alpha.var</span><span class="o">=</span><span class="s">&quot;cos2&quot;</span><span class="p">,</span> <span class="n">select.var</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">cos2</span> <span class="o">=</span> <span class="n">threshold</span><span class="p">),</span>
                 <span class="n">gradient.cols</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;goldenrod1&quot;</span><span class="p">,</span> <span class="s">&quot;firebrick2&quot;</span><span class="p">,</span> <span class="s">&quot;navy&quot;</span><span class="p">),</span> 
                 <span class="n">repel</span> <span class="o">=</span> <span class="kc">TRUE</span> <span class="c1"># Avoid text overlapping</span>
                 <span class="p">)</span><span class="o">+</span> <span class="nf">xlim</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">ylim </span><span class="p">(</span><span class="m">-1</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
                    
                    
    <span class="c1">#make biplot for PC3&amp;4              </span>
    <span class="n">p34</span><span class="o">=</span><span class="nf">fviz_pca_var</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">),</span> <span class="n">col.var</span> <span class="o">=</span> <span class="s">&quot;cos2&quot;</span><span class="p">,</span> <span class="n">alpha.var</span><span class="o">=</span><span class="s">&quot;cos2&quot;</span><span class="p">,</span> <span class="n">select.var</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">cos2</span> <span class="o">=</span> <span class="n">threshold</span><span class="p">),</span>
                 <span class="n">gradient.cols</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;goldenrod1&quot;</span><span class="p">,</span> <span class="s">&quot;firebrick2&quot;</span><span class="p">,</span> <span class="s">&quot;navy&quot;</span><span class="p">),</span> 
                 <span class="n">repel</span> <span class="o">=</span> <span class="kc">TRUE</span> <span class="c1"># Avoid text overlapping</span>
                 <span class="p">)</span><span class="o">+</span> <span class="nf">xlim</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">ylim </span><span class="p">(</span><span class="m">-1</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>

    <span class="c1">#print biplot                </span>
    <span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_biplot12.pdf&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">p12</span><span class="p">)</span>
    <span class="nf">dev.off</span><span class="p">()</span>
                    
    <span class="c1">#print biplot                </span>
    <span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_biplot34.pdf&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">p34</span><span class="p">)</span>
    <span class="nf">dev.off</span><span class="p">()</span>

    <span class="c1">#print charts of variable contrib and cos2</span>

    <span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_corr_cos2_viz.pdf&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="n">corrcos2viz</span> <span class="o">&lt;-</span> <span class="nf">corrplot</span><span class="p">(</span><span class="n">var</span><span class="o">$</span><span class="n">cos2</span><span class="p">,</span> <span class="n">is.corr</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">tl.cex</span> <span class="o">=</span> <span class="m">.5</span><span class="p">)</span>   
    <span class="nf">print</span><span class="p">(</span><span class="n">corrcos2viz</span><span class="p">)</span>
    <span class="nf">dev.off</span><span class="p">()</span>

    <span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_corr_contrib_viz.pdf&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="n">corrcontribviz</span> <span class="o">&lt;-</span> <span class="nf">corrplot</span><span class="p">(</span><span class="n">var</span><span class="o">$</span><span class="n">contrib</span><span class="p">,</span> <span class="n">is.corr</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">tl.cex</span> <span class="o">=</span> <span class="m">.5</span><span class="p">)</span>    
    <span class="nf">print</span><span class="p">(</span><span class="n">corrcontribviz</span><span class="p">)</span>
    <span class="nf">dev.off</span><span class="p">()</span>


    <span class="c1"># Contributions of variables to PC1</span>
    <span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_contributionPC1.pdf&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="n">c1</span><span class="o">=</span><span class="nf">fviz_contrib</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">,</span> <span class="n">choice</span> <span class="o">=</span> <span class="s">&quot;var&quot;</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>              
    <span class="nf">dev.off</span><span class="p">()</span>
    <span class="c1"># Contributions of variables to PC2</span>
    <span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_contributionPC2.pdf&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="n">c2</span><span class="o">=</span><span class="nf">fviz_contrib</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">,</span> <span class="n">choice</span> <span class="o">=</span> <span class="s">&quot;var&quot;</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
    <span class="nf">dev.off</span><span class="p">()</span>
    <span class="c1"># Contributions of variables to PC3</span>
    <span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_contributionPC3.pdf&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="n">c3</span><span class="o">=</span><span class="nf">fviz_contrib</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">,</span> <span class="n">choice</span> <span class="o">=</span> <span class="s">&quot;var&quot;</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">c3</span><span class="p">)</span>
    <span class="nf">dev.off</span><span class="p">()</span>
    <span class="c1"># Contributions of variables to PC4</span>
    <span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_contributionPC4.pdf&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="n">c4</span><span class="o">=</span><span class="nf">fviz_contrib</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">,</span> <span class="n">choice</span> <span class="o">=</span> <span class="s">&quot;var&quot;</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="m">4</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">c4</span><span class="p">)</span>
    <span class="nf">dev.off</span><span class="p">()</span>
    <span class="c1"># Contributions of variables to PC5</span>
    <span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_contributionPC5.pdf&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="n">c5</span><span class="o">=</span><span class="nf">fviz_contrib</span><span class="p">(</span><span class="n">pca.fit</span><span class="p">,</span> <span class="n">choice</span> <span class="o">=</span> <span class="s">&quot;var&quot;</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="m">5</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">c5</span><span class="p">)</span>
    <span class="nf">dev.off</span><span class="p">()</span>



    <span class="c1">###### interactive pca plot</span>
    <span class="c1">#add text response back to pcadata2</span>
    <span class="n">pcadata2</span><span class="o">$</span><span class="n">text</span><span class="o">&lt;-</span><span class="n">data_subset[[question]]</span>
    <span class="n">res.pca</span> <span class="o">&lt;-</span> <span class="nf">PCA</span><span class="p">(</span><span class="n">pcadata2[</span><span class="p">,</span><span class="o">!</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">pcadata2</span><span class="p">)</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;text&quot;</span><span class="p">))</span><span class="n">]</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>

    <span class="c1">#make biplot with individual dots</span>
    <span class="n">test2</span><span class="o">&lt;-</span><span class="nf">fviz_pca_biplot</span><span class="p">(</span><span class="n">res.pca</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span> <span class="n">geom</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;point&#39;</span><span class="p">,</span><span class="s">&#39;text&#39;</span><span class="p">),</span> <span class="n">col.ind</span> <span class="o">=</span> <span class="s">&quot;light blue&quot;</span><span class="p">,</span>
                    <span class="n">pointshape</span> <span class="o">=</span> <span class="m">19</span><span class="p">,</span> <span class="n">pointsize</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span><span class="n">alpha.ind</span> <span class="o">=</span> <span class="m">0.3</span><span class="p">,</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;var&quot;</span><span class="p">,</span> 
                    <span class="n">alpha.var</span> <span class="o">=</span><span class="s">&quot;cos2&quot;</span><span class="p">,</span> <span class="n">select.var</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">cos2</span> <span class="o">=</span> <span class="n">threshold</span><span class="p">),</span>
                     <span class="n">col.var</span> <span class="o">=</span> <span class="s">&quot;cos2&quot;</span><span class="p">,</span><span class="n">gradient.cols</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">)</span>

                    <span class="p">)</span>
                    
                    
      <span class="c1">#labs(fill = &quot;identity&quot;)# Change legend title</span>

    <span class="c1">#add hover text</span>
    <span class="n">mytext</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">pcadata2</span><span class="o">$</span><span class="n">text</span><span class="p">)</span> 
    <span class="n">pp</span><span class="o">=</span><span class="nf">ggplotly</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">test2</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="m">800</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="m">800</span><span class="p">)</span>
    <span class="n">ppp</span><span class="o">=</span><span class="nf">style</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">mytext</span><span class="p">,</span><span class="n">hoverinfo</span><span class="o">=</span><span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">traces</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">))</span>
    <span class="n">htmlwidgets</span><span class="o">::</span><span class="nf">saveWidget</span><span class="p">(</span><span class="nf">as_widget</span><span class="p">(</span><span class="n">ppp</span><span class="p">),</span> <span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_plotly12.html&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
                    
    <span class="n">test3</span><span class="o">&lt;-</span><span class="nf">fviz_pca_biplot</span><span class="p">(</span><span class="n">res.pca</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">),</span> <span class="n">geom</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;point&#39;</span><span class="p">,</span><span class="s">&#39;text&#39;</span><span class="p">),</span> <span class="n">col.ind</span> <span class="o">=</span> <span class="s">&quot;light blue&quot;</span><span class="p">,</span>
                    <span class="n">pointshape</span> <span class="o">=</span> <span class="m">19</span><span class="p">,</span> <span class="n">pointsize</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span><span class="n">alpha.ind</span> <span class="o">=</span> <span class="m">0.3</span><span class="p">,</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;var&quot;</span><span class="p">,</span> 
                    <span class="n">alpha.var</span> <span class="o">=</span><span class="s">&quot;cos2&quot;</span><span class="p">,</span> <span class="n">select.var</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">cos2</span> <span class="o">=</span> <span class="n">threshold</span><span class="p">),</span>
                     <span class="n">col.var</span> <span class="o">=</span> <span class="s">&quot;cos2&quot;</span><span class="p">,</span><span class="n">gradient.cols</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">)</span>

                    <span class="p">)</span>
                    
    <span class="c1">#add hover text</span>
    <span class="n">mytext</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="n">pcadata2</span><span class="o">$</span><span class="n">text</span><span class="p">)</span> 
    <span class="n">pp</span><span class="o">=</span><span class="nf">ggplotly</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">test3</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="m">800</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="m">800</span><span class="p">)</span>
    <span class="n">ppp</span><span class="o">=</span><span class="nf">style</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">mytext</span><span class="p">,</span><span class="n">hoverinfo</span><span class="o">=</span><span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">traces</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">))</span>
    <span class="n">htmlwidgets</span><span class="o">::</span><span class="nf">saveWidget</span><span class="p">(</span><span class="nf">as_widget</span><span class="p">(</span><span class="n">ppp</span><span class="p">),</span> <span class="nf">paste</span><span class="p">(</span><span class="n">question</span><span class="p">,</span><span class="s">&quot;_plotly34.html&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="c1">#example input for parameter question: &quot;career&quot;</span>
<span class="c1">#1st is threshold: set the threshold for cos2. only variables with cos2&gt; threshold will be kept in biplots</span>
<span class="c1">#2nd is percent: set the percentage of 0 in a column; columns with percentage of 0 values &gt; percent will be removedpca_biplot(&#39;barriers&#39;,0.3,0.4)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;career&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;development&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;othergrowth&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;society&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;role&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;barriers&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;feel&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;definition&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;aftercollege4&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;behavior2&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;change&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="nf">pca_biplot</span><span class="p">(</span><span class="s">&#39;childhood2&#39;</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

 


    </main>
    