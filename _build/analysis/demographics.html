---
interact_link: content/analysis/demographics.ipynb
kernel_name: ir
kernel_path: content/analysis
has_widgets: false
title: |-
  Demographic Analysis
pagenum: 32
prev_page:
  url: /analysis/pca.html
next_page:
  url: 
suffix: .ipynb
search: rda data pcalabels into variables functions loop graphs within generating code demographic analysis imports load scripts old update new labels place want using structure filled table google sheets exported csv loaded r resaved file demo alt temp begin tidy define helper filter demographics those min max levels inclusive smalldemos variable questions pcs munging finally recommend letting run say seconds hit twice stop print explore being used ggplot

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

    <main class="jupyter-page">
    <div id="page-info"><div id="page-title">Demographic Analysis</div>
</div>
    <div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="imports">imports<a class="anchor-link" href="#imports"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;ggridges&quot;</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;reshape2&quot;</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;tidyverse&quot;</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;magrittr&quot;</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;broom&quot;</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;FactoMineR&quot;</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;emmeans&quot;</span><span class="p">)</span>

<span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">magrittr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">broom</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">FactoMineR</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">emmeans</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggridges</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
The downloaded binary packages are in
	/var/folders/tt/j3zywfxn4s364d1pj12scs_r0000gq/T//Rtmpah7fVo/downloaded_packages

The downloaded binary packages are in
	/var/folders/tt/j3zywfxn4s364d1pj12scs_r0000gq/T//Rtmpah7fVo/downloaded_packages

The downloaded binary packages are in
	/var/folders/tt/j3zywfxn4s364d1pj12scs_r0000gq/T//Rtmpah7fVo/downloaded_packages

The downloaded binary packages are in
	/var/folders/tt/j3zywfxn4s364d1pj12scs_r0000gq/T//Rtmpah7fVo/downloaded_packages

The downloaded binary packages are in
	/var/folders/tt/j3zywfxn4s364d1pj12scs_r0000gq/T//Rtmpah7fVo/downloaded_packages

The downloaded binary packages are in
	/var/folders/tt/j3zywfxn4s364d1pj12scs_r0000gq/T//Rtmpah7fVo/downloaded_packages
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>also installing the dependencies ‘estimability’, ‘numDeriv’, ‘mvtnorm’


</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
The downloaded binary packages are in
	/var/folders/tt/j3zywfxn4s364d1pj12scs_r0000gq/T//Rtmpah7fVo/downloaded_packages
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Welcome to emmeans.
NOTE -- Important change from versions &lt;= 1.41:
    Indicator predictors are now treated as 2-level factors by default.
    To revert to old behavior, use emm_options(cov.keep = character(0))


Attaching package: ‘reshape2’


The following object is masked from ‘package:tidyr’:

    smiths


</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="load-data,-scripts">load data, scripts<a class="anchor-link" href="#load-data,-scripts"> </a></h2><p>pca_labels.rda is old. You could update it with the new labels in place if you want using the structure of pca_labels.rda. I filled in the table in google sheets, then exported it as a csv, loaded it into R, and then resaved it as a RDA file.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="nf">load</span><span class="p">(</span><span class="s">&#39;./data/merged_artsengagement.rda&#39;</span><span class="p">)</span>
<span class="nf">load</span><span class="p">(</span><span class="s">&#39;./data/tidy_questions_best.Rda&#39;</span><span class="p">)</span>
<span class="nf">source</span><span class="p">(</span><span class="s">&#39;./scripts/select_helpers.R&#39;</span><span class="p">)</span>
<span class="nf">load</span><span class="p">(</span><span class="s">&#39;./data/pca_labels.rda&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Demo-Variables">Demo Variables<a class="anchor-link" href="#Demo-Variables"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="c1"># all factors vvv</span>
<span class="c1"># df[df %&gt;% sapply(is.factor) %&gt;% as.vector, rownums]</span>
<span class="n">motiv_demos</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">contains</span><span class="p">(</span><span class="s">&#39;sr_motivation&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="n">names</span>
<span class="n">identity_demos</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">contains</span><span class="p">(</span><span class="s">&#39;sr_identity&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="n">names</span>
<span class="n">participation_demos</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">all_arts</span><span class="p">(</span><span class="s">&#39;participation&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">starts_with</span><span class="p">(</span><span class="s">&#39;sr&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="n">names</span>
<span class="n">real_demos</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;ethnic_group&#39;</span><span class="p">,</span> <span class="s">&#39;sex&#39;</span><span class="p">,</span> <span class="s">&#39;school&#39;</span><span class="p">,</span> <span class="s">&#39;parented&#39;</span><span class="p">,</span> <span class="s">&#39;income&#39;</span><span class="p">,</span> <span class="s">&#39;artsincollege&#39;</span><span class="p">,</span> <span class="s">&#39;hstype&#39;</span><span class="p">,</span> <span class="s">&#39;hssize&#39;</span><span class="p">,</span>
           <span class="s">&#39;hslocation&#39;</span><span class="p">,</span> <span class="s">&#39;hs_arts_freq&#39;</span><span class="p">,</span> <span class="s">&#39;hs_encouragement&#39;</span><span class="p">,</span> <span class="s">&#39;hs_required&#39;</span><span class="p">,</span> <span class="s">&#39;hs_fees&#39;</span><span class="p">,</span>
           <span class="s">&#39;so_childhood1&#39;</span><span class="p">,</span> <span class="s">&#39;so_childhood3&#39;</span><span class="p">,</span> <span class="s">&#39;so_childhood5&#39;</span><span class="p">,</span> <span class="s">&#39;sr_participated&#39;</span><span class="p">,</span>
               <span class="s">&#39;sr_highestdegreeplanned&#39;</span><span class="p">)</span>
<span class="n">demo_groups</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;real_demos&#39;</span><span class="p">,</span><span class="s">&#39;motiv_demos&#39;</span><span class="p">,</span><span class="s">&#39;identity_demos&#39;</span><span class="p">,</span><span class="s">&#39;participation_demos&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Functions">Functions<a class="anchor-link" href="#Functions"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">stripnames</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">data</span> <span class="o">&lt;-</span> <span class="n">data</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="s">&#39;rownums&#39;</span><span class="p">,</span> <span class="nf">starts_with</span><span class="p">(</span><span class="n">question</span><span class="p">))</span>
    <span class="n">varnames</span> <span class="o">&lt;-</span> <span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">newnames</span> <span class="o">&lt;-</span> <span class="n">varnames</span>
    <span class="nf">for </span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="nf">length</span><span class="p">(</span><span class="n">varnames</span><span class="p">)))</span> <span class="p">{</span>
        <span class="n">newnames[i]</span> <span class="o">&lt;-</span> <span class="nf">substr</span><span class="p">(</span><span class="n">varnames[i]</span><span class="p">,</span> <span class="nf">gregexpr</span><span class="p">(</span><span class="s">&quot;\\.\\.&quot;</span><span class="p">,</span> <span class="n">varnames[i]</span><span class="p">)</span><span class="n">[[1]][1]</span><span class="m">+2</span><span class="p">,</span> <span class="nf">nchar</span><span class="p">(</span><span class="n">varnames[i]</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">newnames</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">stripVars</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">#remove irrelavant variables</span>
    <span class="n">removenames</span> <span class="o">&lt;-</span> <span class="nf">names</span><span class="p">(</span><span class="n">data</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="s">&quot;AIC..Words|AIC..IC_Differentiation|AIC..IC_Integration|AIC..DIAL_Differentiation|AIC..DIAL_Integration|AIC..ELAB_Differentiation|AIC..ELAB_Integration|docuscope..OralCues|docuscope..DialogCues|docuscope..XWordTokens|docuscope..XPunctuationTokens|docuscope..XTokens|LIWC..WC|LIWC..Sixltr|LIWC..Dic|LIWC..WPS|LIWC..swear|LIWC..netspeak|LIWC..assent|LIWC..nonflu|LIWC..filler|LIWC..AllPunc|LIWC..Period|LIWC..Comma|LIWC..Colon|LIWC..SemiC|LIWC..QMark|LIWC..Exclam|LIWC..Dash|LIWC..Quote|LIWC..Apostro|LIWC..Parenth|LIWC..OtherP&quot;</span><span class="p">)))</span>
    <span class="n">data</span> <span class="o">&lt;-</span> <span class="n">data[</span> <span class="p">,</span> <span class="o">!</span><span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">%in%</span> <span class="n">removenames]</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">mergeQuestion</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">if </span><span class="p">(</span><span class="nf">substr</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;_&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">question</span> <span class="o">&lt;-</span> <span class="nf">substr</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="nf">nchar</span><span class="p">(</span><span class="n">question</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="c1"># if you&#39;re aware of other prefixes, add them here</span>
    <span class="n">yrs</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="s">&#39;fl&#39;</span><span class="p">,</span><span class="s">&#39;f1&#39;</span><span class="p">,</span><span class="s">&#39;f2&#39;</span><span class="p">,</span><span class="s">&#39;so&#39;</span><span class="p">,</span><span class="s">&#39;jr&#39;</span><span class="p">,</span><span class="s">&#39;sr&#39;</span><span class="p">,</span><span class="s">&#39;sl&#39;</span><span class="p">)</span>
    <span class="n">data</span><span class="o">$</span><span class="n">rownums</span> <span class="o">&lt;-</span> <span class="nf">seq</span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="c1"># add rownums so resulting data can be re-integrated</span>
    <span class="n">mergeddf</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">()</span>
    <span class="nf">for </span><span class="p">(</span><span class="n">yr</span> <span class="n">in</span> <span class="n">yrs</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">if </span><span class="p">(</span><span class="n">question</span> <span class="o">==</span> <span class="s">&#39;definition&#39;</span> <span class="o">&amp;&amp;</span> <span class="nf">is.na</span><span class="p">(</span><span class="n">yr</span><span class="p">))</span>
            <span class="n">qyr</span> <span class="o">&lt;-</span> <span class="n">question</span>
        <span class="n">else</span> <span class="nf">if </span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">yr</span><span class="p">))</span>
            <span class="n">next</span>
        <span class="n">else</span> <span class="p">{</span>
            <span class="n">qyr</span> <span class="o">&lt;-</span> <span class="nf">paste0</span><span class="p">(</span><span class="n">yr</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nf">if </span><span class="p">(</span><span class="n">data</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">starts_with</span><span class="p">(</span><span class="n">qyr</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="n">ncol</span> <span class="o">==</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span> <span class="n">next</span> <span class="p">}</span>
        <span class="n">tempdf</span> <span class="o">&lt;-</span> <span class="nf">stripnames</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">qyr</span><span class="p">)</span>
        <span class="nf">names</span><span class="p">(</span><span class="n">tempdf</span><span class="p">)</span><span class="n">[2]</span> <span class="o">&lt;-</span> <span class="n">question</span>
        <span class="n">mergeddf</span> <span class="o">&lt;-</span> <span class="nf">bind_rows</span><span class="p">(</span><span class="n">mergeddf</span><span class="p">,</span> <span class="n">tempdf</span><span class="p">)</span>        
    <span class="p">}</span>
    <span class="n">mergeddf</span> <span class="o">&lt;-</span> <span class="n">mergeddf</span><span class="nf">[complete.cases</span><span class="p">(</span><span class="n">mergeddf</span><span class="p">),</span><span class="n">]</span>
    <span class="n">mergeddf</span> <span class="o">&lt;-</span> <span class="n">mergeddf</span> <span class="o">%&gt;%</span> <span class="n">stripVars</span>
    <span class="nf">rownames</span><span class="p">(</span><span class="n">mergeddf</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">()</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">mergeddf</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="alt-temp">alt temp<a class="anchor-link" href="#alt-temp"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">temp</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="nf">matches</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="s">&#39;PC[&#39;</span><span class="p">,</span><span class="nf">paste0</span><span class="p">(</span><span class="nf">seq</span><span class="p">(</span><span class="m">5</span><span class="p">)</span><span class="nf">[seq</span><span class="p">(</span><span class="m">5</span><span class="p">)</span><span class="o">!=</span><span class="n">p]</span><span class="p">,</span> <span class="n">collapse</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">),</span><span class="s">&#39;]&#39;</span><span class="p">)))</span>
<span class="nf">names</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="nf">[ncol</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="s">&#39;pc&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="all-loop">all loop<a class="anchor-link" href="#all-loop"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">sig_contrasts.demos</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">()</span>
<span class="n">sig_aov_posthoc</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">()</span>
<span class="nf">dir.create</span><span class="p">(</span><span class="s">&#39;./results&#39;</span><span class="p">,</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
<span class="nf">for</span><span class="p">(</span><span class="n">question</span> <span class="n">in</span> <span class="n">question_names[</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="m">9</span><span class="o">:</span><span class="m">14</span><span class="p">)</span><span class="n">]</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1"># directories</span>
    <span class="nf">dir.create</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">&#39;./results&#39;</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span><span class="p">),</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
    
    <span class="c1"># data subsetting, PC</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="nf">mergeQuestion</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span>
    <span class="n">data_subset_rows</span> <span class="o">&lt;-</span> <span class="n">data_subset[[1]]</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset[</span><span class="m">-1</span><span class="n">]</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset[</span><span class="m">-1</span><span class="n">]</span>
    <span class="n">percent</span> <span class="o">&lt;-</span> <span class="m">0.4</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset[</span> <span class="nf">lapply</span><span class="p">(</span> <span class="n">data_subset</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="m">0</span><span class="p">)</span> <span class="o">/</span> <span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="n">percent</span> <span class="n">]</span>
    <span class="n">pd</span> <span class="o">&lt;-</span> <span class="nf">prcomp</span><span class="p">(</span><span class="n">data_subset</span><span class="p">,</span> <span class="n">retx</span><span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>

    <span class="c1"># merge with demographic cols</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">rownum</span> <span class="o">=</span> <span class="n">data_subset_rows</span><span class="p">,</span> <span class="n">pd</span><span class="o">$</span><span class="n">x[</span><span class="p">,</span><span class="nf">seq</span><span class="p">(</span><span class="m">5</span><span class="p">)</span><span class="n">]</span> <span class="o">%&gt;%</span> <span class="n">as.data.frame</span><span class="p">)</span>
    <span class="n">rownums</span> <span class="o">&lt;-</span> <span class="n">pcs</span><span class="o">$</span><span class="n">rownum</span> <span class="o">%&gt;%</span> <span class="n">sort</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="n">pcs</span> <span class="o">%&gt;%</span> <span class="nf">arrange</span><span class="p">(</span><span class="n">rownum</span><span class="p">)</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="n">pcs[</span><span class="m">-1</span><span class="n">]</span>
    <span class="n">demodfpcs</span> <span class="o">&lt;-</span> <span class="nf">bind_cols</span><span class="p">(</span><span class="n">df[rownums</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span><span class="n">real_demos</span><span class="p">)</span><span class="n">]</span><span class="p">,</span> <span class="n">pcs</span><span class="p">)</span>

    <span class="c1"># weighting by # of responses per respondent</span>
    <span class="n">resps_by_key</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span><span class="o">$</span><span class="n">key</span> <span class="o">%&gt;%</span> <span class="n">table</span> <span class="o">%&gt;%</span> <span class="n">as.data.frame</span>
    <span class="nf">names</span><span class="p">(</span><span class="n">resps_by_key</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span><span class="s">&#39;n&#39;</span><span class="p">)</span>
    <span class="n">resps_by_key</span> <span class="o">%&lt;&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">n</span><span class="o">!=</span><span class="m">0</span><span class="p">)</span>
    <span class="nf">for</span><span class="p">(</span><span class="n">r</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">)))</span> <span class="p">{</span>
        <span class="n">nresps</span> <span class="o">&lt;-</span> <span class="n">resps_by_key</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">demodfpcs[r</span><span class="p">,</span><span class="n">]</span><span class="o">$</span><span class="n">key</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">.$n</span>
        <span class="n">demodfpcs[r</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">,</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">)))</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="n">nresps</span><span class="p">)</span> <span class="o">*</span>
                                                            <span class="p">(</span><span class="n">demodfpcs[r</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">,</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">)))</span><span class="n">]</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">demodfpcs</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="s">&#39;key&#39;</span><span class="p">)</span>
    <span class="n">demodf</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">))</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">))</span>

    <span class="c1"># analysis</span>
    <span class="nf">for</span><span class="p">(</span><span class="n">p</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="n">pcs</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1"># directories</span>
        <span class="nf">dir.create</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">&#39;./results&#39;</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="n">pcs</span><span class="p">)</span><span class="n">[p]</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span><span class="p">),</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
        <span class="nf">dir.create</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">&#39;./results&#39;</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="n">pcs</span><span class="p">)</span><span class="n">[p]</span><span class="p">,</span> <span class="s">&#39;emmeans&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span><span class="p">),</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
        <span class="nf">dir.create</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">&#39;./results&#39;</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="n">pcs</span><span class="p">)</span><span class="n">[p]</span><span class="p">,</span> <span class="s">&#39;anova_tukey&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span><span class="p">),</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
        <span class="nf">for</span><span class="p">(</span><span class="n">d</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="n">demodf</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">temp</span> <span class="o">&lt;-</span> <span class="nf">bind_cols</span><span class="p">(</span><span class="n">pcs[p]</span><span class="p">,</span> <span class="n">demodf[d]</span><span class="p">)</span>
            <span class="nf">names</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;pc&#39;</span><span class="p">,</span><span class="s">&#39;demo&#39;</span><span class="p">)</span>
            <span class="nf">if</span><span class="p">((</span><span class="n">temp</span><span class="o">$</span><span class="n">demo</span> <span class="o">%&gt;%</span> <span class="n">table</span> <span class="o">%&gt;%</span> <span class="n">as.data.frame</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">Freq</span> <span class="o">!=</span> <span class="m">0</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">nrow</span><span class="p">)</span> <span class="o">==</span> <span class="m">1</span><span class="p">)</span> <span class="n">next</span>

            <span class="c1"># emmeans contrasts</span>
            <span class="n">lm.out</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">pc</span> <span class="o">~</span> <span class="n">demo</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">temp</span><span class="p">,</span> <span class="n">na.action</span> <span class="o">=</span> <span class="n">na.exclude</span><span class="p">)</span>
            <span class="n">em.out</span> <span class="o">&lt;-</span> <span class="nf">emmeans</span><span class="p">(</span><span class="n">lm.out</span><span class="p">,</span> <span class="o">~</span> <span class="n">demo</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">temp</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="s">&#39;proportional&#39;</span><span class="p">)</span>
            <span class="n">contrast.out</span> <span class="o">&lt;-</span> <span class="nf">contrast</span><span class="p">(</span><span class="n">em.out</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&quot;del.eff&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">tidy</span>

            <span class="n">contrast.out</span><span class="o">$</span><span class="n">p.value</span> <span class="o">%&lt;&gt;%</span> <span class="nf">p.adjust</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s">&#39;holm&#39;</span><span class="p">)</span>
            <span class="n">contrast.out</span> <span class="o">%&lt;&gt;%</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">question_name</span><span class="o">=</span><span class="n">question</span><span class="p">,</span>
                                        <span class="n">PC_num</span> <span class="o">=</span> <span class="nf">paste0</span><span class="p">(</span><span class="s">&#39;PC&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span> 
                                        <span class="n">PC_pos</span> <span class="o">=</span> <span class="n">pca_labels</span> <span class="o">%&gt;%</span> 
                                                  <span class="nf">filter</span><span class="p">(</span><span class="n">question_name</span><span class="o">==</span><span class="n">question</span><span class="p">)</span> <span class="o">%&gt;%</span> 
                                                  <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;_pos&#39;</span><span class="p">)))</span> <span class="o">%&gt;%</span>
                                                  <span class="n">pull</span> <span class="o">%&gt;%</span> <span class="n">as.character</span><span class="p">,</span>
                                        <span class="n">PC_neg</span> <span class="o">=</span> <span class="n">pca_labels</span> <span class="o">%&gt;%</span> 
                                                  <span class="nf">filter</span><span class="p">(</span><span class="n">question_name</span><span class="o">==</span><span class="n">question</span><span class="p">)</span> <span class="o">%&gt;%</span> 
                                                  <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;_neg&#39;</span><span class="p">)))</span> <span class="o">%&gt;%</span>
                                                  <span class="n">pull</span> <span class="o">%&gt;%</span> <span class="n">as.character</span><span class="p">,</span>
                                        <span class="n">demographic</span> <span class="o">=</span> <span class="nf">names</span><span class="p">(</span><span class="n">demodf</span><span class="p">)</span><span class="n">[d]</span>
                                     <span class="p">)</span>            

            <span class="c1"># anova tukey</span>
            <span class="n">aov.out</span> <span class="o">&lt;-</span> <span class="nf">aov</span><span class="p">(</span><span class="n">pc</span> <span class="o">~</span> <span class="n">demo</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">temp</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">TukeyHSD</span> <span class="o">%&gt;%</span> <span class="n">tidy</span>
            <span class="n">aov.out</span> <span class="o">%&lt;&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">term</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">question_name</span><span class="o">=</span><span class="n">question</span><span class="p">,</span>
                                        <span class="n">PC_num</span> <span class="o">=</span> <span class="nf">paste0</span><span class="p">(</span><span class="s">&#39;PC&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span> 
                                        <span class="n">PC_pos</span> <span class="o">=</span> <span class="n">pca_labels</span> <span class="o">%&gt;%</span> 
                                                  <span class="nf">filter</span><span class="p">(</span><span class="n">question_name</span><span class="o">==</span><span class="n">question</span><span class="p">)</span> <span class="o">%&gt;%</span> 
                                                  <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;_pos&#39;</span><span class="p">)))</span> <span class="o">%&gt;%</span>
                                                  <span class="n">pull</span> <span class="o">%&gt;%</span> <span class="n">as.character</span><span class="p">,</span>
                                        <span class="n">PC_neg</span> <span class="o">=</span> <span class="n">pca_labels</span> <span class="o">%&gt;%</span> 
                                                  <span class="nf">filter</span><span class="p">(</span><span class="n">question_name</span><span class="o">==</span><span class="n">question</span><span class="p">)</span> <span class="o">%&gt;%</span> 
                                                  <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;_neg&#39;</span><span class="p">)))</span> <span class="o">%&gt;%</span>
                                                  <span class="n">pull</span> <span class="o">%&gt;%</span> <span class="n">as.character</span><span class="p">,</span>
                                        <span class="n">demographic</span> <span class="o">=</span> <span class="nf">names</span><span class="p">(</span><span class="n">demodf</span><span class="p">)</span><span class="n">[d]</span>
                                     <span class="p">)</span>
            
            <span class="c1"># bind rows</span>
            <span class="nf">options</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="m">-1</span><span class="p">)</span>
            <span class="n">sig_contrasts.demos</span> <span class="o">%&lt;&gt;%</span> <span class="nf">bind_rows</span><span class="p">(</span><span class="n">contrast.out</span><span class="p">)</span>
            <span class="n">sig_aov_posthoc</span> <span class="o">%&lt;&gt;%</span> <span class="nf">bind_rows</span><span class="p">(</span><span class="n">aov.out</span><span class="p">)</span>
            <span class="nf">options</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="m">0</span><span class="p">)</span>
            
            <span class="c1"># write csvs</span>
            <span class="nf">write.csv</span><span class="p">(</span><span class="n">contrast.out</span><span class="p">,</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&#39;./results&#39;</span><span class="p">,</span><span class="n">question</span><span class="p">,</span><span class="nf">names</span><span class="p">(</span><span class="n">pcs</span><span class="p">)</span><span class="n">[p]</span><span class="p">,</span><span class="s">&#39;emmeans&#39;</span><span class="p">,</span><span class="nf">paste0</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">demodf</span><span class="p">)</span><span class="n">[d]</span><span class="p">,</span><span class="s">&#39;.csv&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&#39;/&#39;</span><span class="p">))</span>
            <span class="nf">write.csv</span><span class="p">(</span><span class="n">aov.out</span><span class="p">,</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&#39;./results&#39;</span><span class="p">,</span><span class="n">question</span><span class="p">,</span><span class="nf">names</span><span class="p">(</span><span class="n">pcs</span><span class="p">)</span><span class="n">[p]</span><span class="p">,</span><span class="s">&#39;anova_tukey&#39;</span><span class="p">,</span><span class="nf">paste0</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">demodf</span><span class="p">)</span><span class="n">[d]</span><span class="p">,</span><span class="s">&#39;.csv&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&#39;/&#39;</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1"># # write rdas</span>
<span class="nf">save</span><span class="p">(</span><span class="n">sig_contrasts.demos</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s">&#39;./results/emmeans_contrasts.rda&#39;</span><span class="p">)</span>
<span class="nf">save</span><span class="p">(</span><span class="n">sig_aov_posthoc</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s">&#39;./results/anova_tukey.rda&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="begin-tidy-graphs">begin tidy graphs<a class="anchor-link" href="#begin-tidy-graphs"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">real_demos</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;ethnic_group&#39;</span><span class="p">,</span> <span class="s">&#39;sex&#39;</span><span class="p">,</span> <span class="s">&#39;school&#39;</span><span class="p">,</span> <span class="s">&#39;parented&#39;</span><span class="p">,</span> <span class="s">&#39;income&#39;</span><span class="p">,</span> <span class="s">&#39;artsincollege&#39;</span><span class="p">,</span> <span class="s">&#39;hstype&#39;</span><span class="p">,</span> <span class="s">&#39;hssize&#39;</span><span class="p">,</span>
           <span class="s">&#39;hslocation&#39;</span><span class="p">,</span> <span class="s">&#39;hs_arts_freq&#39;</span><span class="p">,</span> <span class="s">&#39;hs_encouragement&#39;</span><span class="p">,</span> <span class="s">&#39;hs_required&#39;</span><span class="p">,</span> <span class="s">&#39;hs_fees&#39;</span><span class="p">,</span>
           <span class="s">&#39;so_childhood1&#39;</span><span class="p">,</span> <span class="s">&#39;so_childhood3&#39;</span><span class="p">,</span> <span class="s">&#39;so_childhood5&#39;</span><span class="p">,</span> <span class="s">&#39;sr_participated&#39;</span><span class="p">,</span>
               <span class="s">&#39;sr_highestdegreeplanned&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="define-helper-functions">define helper functions<a class="anchor-link" href="#define-helper-functions"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">stripnames</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">data</span> <span class="o">&lt;-</span> <span class="n">data</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="s">&#39;rownums&#39;</span><span class="p">,</span> <span class="nf">starts_with</span><span class="p">(</span><span class="n">question</span><span class="p">))</span>
    <span class="n">varnames</span> <span class="o">&lt;-</span> <span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">newnames</span> <span class="o">&lt;-</span> <span class="n">varnames</span>
    <span class="nf">for </span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="nf">length</span><span class="p">(</span><span class="n">varnames</span><span class="p">)))</span> <span class="p">{</span>
        <span class="n">newnames[i]</span> <span class="o">&lt;-</span> <span class="nf">substr</span><span class="p">(</span><span class="n">varnames[i]</span><span class="p">,</span> <span class="nf">gregexpr</span><span class="p">(</span><span class="s">&quot;\\.\\.&quot;</span><span class="p">,</span> <span class="n">varnames[i]</span><span class="p">)</span><span class="n">[[1]][1]</span><span class="m">+2</span><span class="p">,</span> <span class="nf">nchar</span><span class="p">(</span><span class="n">varnames[i]</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">newnames</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">stripVars</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">#remove irrelavant variables</span>
    <span class="n">removenames</span> <span class="o">&lt;-</span> <span class="nf">names</span><span class="p">(</span><span class="n">data</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="s">&quot;AIC..Words|AIC..IC_Differentiation|AIC..IC_Integration|AIC..DIAL_Differentiation|AIC..DIAL_Integration|AIC..ELAB_Differentiation|AIC..ELAB_Integration|docuscope..OralCues|docuscope..DialogCues|docuscope..XWordTokens|docuscope..XPunctuationTokens|docuscope..XTokens|LIWC..WC|LIWC..Sixltr|LIWC..Dic|LIWC..WPS|LIWC..swear|LIWC..netspeak|LIWC..assent|LIWC..nonflu|LIWC..filler|LIWC..AllPunc|LIWC..Period|LIWC..Comma|LIWC..Colon|LIWC..SemiC|LIWC..QMark|LIWC..Exclam|LIWC..Dash|LIWC..Quote|LIWC..Apostro|LIWC..Parenth|LIWC..OtherP&quot;</span><span class="p">)))</span>
    <span class="n">data</span> <span class="o">&lt;-</span> <span class="n">data[</span> <span class="p">,</span> <span class="o">!</span><span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">%in%</span> <span class="n">removenames]</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">mergeQuestion</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">if </span><span class="p">(</span><span class="nf">substr</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;_&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">question</span> <span class="o">&lt;-</span> <span class="nf">substr</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="nf">nchar</span><span class="p">(</span><span class="n">question</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="c1"># if you&#39;re aware of other prefixes, add them here</span>
    <span class="n">yrs</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="s">&#39;fl&#39;</span><span class="p">,</span><span class="s">&#39;f1&#39;</span><span class="p">,</span><span class="s">&#39;f2&#39;</span><span class="p">,</span><span class="s">&#39;so&#39;</span><span class="p">,</span><span class="s">&#39;jr&#39;</span><span class="p">,</span><span class="s">&#39;sr&#39;</span><span class="p">,</span><span class="s">&#39;sl&#39;</span><span class="p">)</span>
    <span class="n">data</span><span class="o">$</span><span class="n">rownums</span> <span class="o">&lt;-</span> <span class="nf">seq</span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="c1"># add rownums so resulting data can be re-integrated</span>
    <span class="n">mergeddf</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">()</span>
    <span class="nf">for </span><span class="p">(</span><span class="n">yr</span> <span class="n">in</span> <span class="n">yrs</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">if </span><span class="p">(</span><span class="n">question</span> <span class="o">==</span> <span class="s">&#39;definition&#39;</span> <span class="o">&amp;&amp;</span> <span class="nf">is.na</span><span class="p">(</span><span class="n">yr</span><span class="p">))</span>
            <span class="n">qyr</span> <span class="o">&lt;-</span> <span class="n">question</span>
        <span class="n">else</span> <span class="nf">if </span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">yr</span><span class="p">))</span>
            <span class="n">next</span>
        <span class="n">else</span> <span class="p">{</span>
            <span class="n">qyr</span> <span class="o">&lt;-</span> <span class="nf">paste0</span><span class="p">(</span><span class="n">yr</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nf">if </span><span class="p">(</span><span class="n">data</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">starts_with</span><span class="p">(</span><span class="n">qyr</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="n">ncol</span> <span class="o">==</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span> <span class="n">next</span> <span class="p">}</span>
        <span class="n">tempdf</span> <span class="o">&lt;-</span> <span class="nf">stripnames</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">qyr</span><span class="p">)</span>
        <span class="nf">names</span><span class="p">(</span><span class="n">tempdf</span><span class="p">)</span><span class="n">[2]</span> <span class="o">&lt;-</span> <span class="n">question</span>
        <span class="n">mergeddf</span> <span class="o">&lt;-</span> <span class="nf">bind_rows</span><span class="p">(</span><span class="n">mergeddf</span><span class="p">,</span> <span class="n">tempdf</span><span class="p">)</span>        
    <span class="p">}</span>
    <span class="n">mergeddf</span> <span class="o">&lt;-</span> <span class="n">mergeddf</span><span class="nf">[complete.cases</span><span class="p">(</span><span class="n">mergeddf</span><span class="p">),</span><span class="n">]</span>
    <span class="n">mergeddf</span> <span class="o">&lt;-</span> <span class="n">mergeddf</span> <span class="o">%&gt;%</span> <span class="n">stripVars</span>
    <span class="nf">rownames</span><span class="p">(</span><span class="n">mergeddf</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">()</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">mergeddf</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">question</span> <span class="o">&lt;-</span> <span class="n">question_names[</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="m">9</span><span class="o">:</span><span class="m">14</span><span class="p">)</span><span class="n">][3]</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="c1"># data subsetting, PC</span>
<span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="nf">mergeQuestion</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span>
<span class="n">data_subset_rows</span> <span class="o">&lt;-</span> <span class="n">data_subset[[1]]</span>
<span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset[</span><span class="m">-1</span><span class="n">]</span>
<span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset[</span><span class="m">-1</span><span class="n">]</span>
<span class="n">percent</span> <span class="o">&lt;-</span> <span class="m">0.4</span>
<span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset[</span> <span class="nf">lapply</span><span class="p">(</span> <span class="n">data_subset</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="m">0</span><span class="p">)</span> <span class="o">/</span> <span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="n">percent</span> <span class="n">]</span>
<span class="n">pd</span> <span class="o">&lt;-</span> <span class="nf">prcomp</span><span class="p">(</span><span class="n">data_subset</span><span class="p">,</span> <span class="n">retx</span><span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>

<span class="c1"># merge with demographic cols</span>
<span class="n">pcs</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">rownum</span> <span class="o">=</span> <span class="n">data_subset_rows</span><span class="p">,</span> <span class="n">pd</span><span class="o">$</span><span class="n">x[</span><span class="p">,</span><span class="nf">seq</span><span class="p">(</span><span class="m">5</span><span class="p">)</span><span class="n">]</span> <span class="o">%&gt;%</span> <span class="n">as.data.frame</span><span class="p">)</span>
<span class="n">rownums</span> <span class="o">&lt;-</span> <span class="n">pcs</span><span class="o">$</span><span class="n">rownum</span> <span class="o">%&gt;%</span> <span class="n">sort</span>
<span class="n">pcs</span> <span class="o">&lt;-</span> <span class="n">pcs</span> <span class="o">%&gt;%</span> <span class="nf">arrange</span><span class="p">(</span><span class="n">rownum</span><span class="p">)</span>
<span class="n">pcs</span> <span class="o">&lt;-</span> <span class="n">pcs[</span><span class="m">-1</span><span class="n">]</span>
<span class="n">demodfpcs</span> <span class="o">&lt;-</span> <span class="nf">bind_cols</span><span class="p">(</span><span class="n">df[rownums</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span><span class="n">real_demos</span><span class="p">)</span><span class="n">]</span><span class="p">,</span> <span class="n">pcs</span><span class="p">)</span>

<span class="c1"># weighting by # of responses per respondent</span>
<span class="n">resps_by_key</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span><span class="o">$</span><span class="n">key</span> <span class="o">%&gt;%</span> <span class="n">table</span> <span class="o">%&gt;%</span> <span class="n">as.data.frame</span>
<span class="nf">names</span><span class="p">(</span><span class="n">resps_by_key</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span><span class="s">&#39;n&#39;</span><span class="p">)</span>
<span class="n">resps_by_key</span> <span class="o">%&lt;&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">n</span><span class="o">!=</span><span class="m">0</span><span class="p">)</span>
<span class="nf">for</span><span class="p">(</span><span class="n">r</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">)))</span> <span class="p">{</span>
    <span class="n">nresps</span> <span class="o">&lt;-</span> <span class="n">resps_by_key</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">demodfpcs[r</span><span class="p">,</span><span class="n">]</span><span class="o">$</span><span class="n">key</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">.$n</span>
    <span class="n">demodfpcs[r</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">,</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">)))</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="n">nresps</span><span class="p">)</span> <span class="o">*</span>
                                                        <span class="p">(</span><span class="n">demodfpcs[r</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">,</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">)))</span><span class="n">]</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">demodfpcs</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="s">&#39;key&#39;</span><span class="p">)</span>
<span class="n">demodf</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">))</span>
<span class="n">pcs</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">))</span>

<span class="c1"># analysis</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Filter-demographics-to-those-within-min-&amp;-max-levels-(inclusive)-into-small_demos-variable">Filter demographics to those within min &amp; max levels (inclusive) into small_demos variable<a class="anchor-link" href="#Filter-demographics-to-those-within-min-&amp;-max-levels-(inclusive)-into-small_demos-variable"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">min</span> <span class="o">=</span> <span class="m">2</span>
<span class="n">max</span> <span class="o">=</span> <span class="m">24</span>
<span class="n">temp</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">sapply</span><span class="p">(</span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)(</span><span class="n">x</span> <span class="o">%&gt;%</span> <span class="n">levels</span> <span class="o">%&gt;%</span> <span class="n">length</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="n">as.data.frame</span>
<span class="n">temp</span><span class="o">$</span><span class="n">demo</span> <span class="o">&lt;-</span> <span class="nf">rownames</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
<span class="n">temp</span> <span class="o">&lt;-</span> <span class="n">temp</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">. </span><span class="o">&gt;=</span> <span class="n">min</span> <span class="o">&amp;</span> <span class="n">max</span> <span class="o">&gt;=</span> <span class="n">.)</span>
<span class="n">small_demos</span> <span class="o">&lt;-</span> <span class="n">temp</span> <span class="o">%&gt;%</span> <span class="nf">pull</span><span class="p">(</span><span class="n">demo</span><span class="p">)</span>
<span class="n">small_demos</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<ol class=list-inline>
	<li>'ethnic_group'</li>
	<li>'sex'</li>
	<li>'school'</li>
	<li>'parented'</li>
	<li>'income'</li>
	<li>'artsincollege'</li>
	<li>'hstype'</li>
	<li>'hssize'</li>
	<li>'hslocation'</li>
	<li>'hs_arts_freq'</li>
	<li>'hs_encouragement'</li>
	<li>'hs_required'</li>
	<li>'hs_fees'</li>
	<li>'so_childhood1'</li>
	<li>'so_childhood3'</li>
	<li>'so_childhood5'</li>
	<li>'sr_participated'</li>
	<li>'sr_highestdegreeplanned'</li>
</ol>

</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Loop-over-all-questions,-generating-PCs,-munging-their-data,-and-finally-generating-graphs-for-them-all">Loop over all questions, generating PCs, munging their data, and finally generating graphs for them all<a class="anchor-link" href="#Loop-over-all-questions,-generating-PCs,-munging-their-data,-and-finally-generating-graphs-for-them-all"> </a></h2><p>I recommend letting the code run for say 10 seconds then hit i twice to stop it to then print out / explore the variables being used within the ggplot code.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">dir_to_save_results</span> <span class="o">=</span> <span class="s">&#39;./results-jan&#39;</span>
<span class="n">plot_type</span> <span class="o">=</span> <span class="s">&#39;violin_plots&#39;</span> <span class="c1"># plural</span>
<span class="n">output_format</span> <span class="o">=</span> <span class="s">&#39;.pdf&#39;</span> <span class="c1"># with dot</span>

<span class="nf">dir.create</span><span class="p">(</span><span class="n">dir_to_save_results</span><span class="p">,</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
<span class="c1"># for all stm&#39;d questions</span>
<span class="nf">for</span><span class="p">(</span><span class="n">question</span> <span class="n">in</span> <span class="n">question_names[</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="m">9</span><span class="o">:</span><span class="m">14</span><span class="p">)</span><span class="n">]</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">dir.create</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">dir_to_save_results</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span><span class="p">),</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
    
    <span class="c1"># data subsetting, PC creation</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="nf">mergeQuestion</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span>
    <span class="n">data_subset_rows</span> <span class="o">&lt;-</span> <span class="n">data_subset[[1]]</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset[</span><span class="m">-1</span><span class="n">]</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset[</span><span class="m">-1</span><span class="n">]</span>
    <span class="n">percent</span> <span class="o">&lt;-</span> <span class="m">0.4</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset[</span> <span class="nf">lapply</span><span class="p">(</span> <span class="n">data_subset</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="m">0</span><span class="p">)</span> <span class="o">/</span> <span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="n">percent</span> <span class="n">]</span>
    <span class="n">pd</span> <span class="o">&lt;-</span> <span class="nf">prcomp</span><span class="p">(</span><span class="n">data_subset</span><span class="p">,</span> <span class="n">retx</span><span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>

    <span class="c1"># merge PCs with demographic cols</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">rownum</span> <span class="o">=</span> <span class="n">data_subset_rows</span><span class="p">,</span> <span class="n">pd</span><span class="o">$</span><span class="n">x[</span><span class="p">,</span><span class="nf">seq</span><span class="p">(</span><span class="m">5</span><span class="p">)</span><span class="n">]</span> <span class="o">%&gt;%</span> <span class="n">as.data.frame</span><span class="p">)</span>
    <span class="n">rownums</span> <span class="o">&lt;-</span> <span class="n">pcs</span><span class="o">$</span><span class="n">rownum</span> <span class="o">%&gt;%</span> <span class="n">sort</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="n">pcs</span> <span class="o">%&gt;%</span> <span class="nf">arrange</span><span class="p">(</span><span class="n">rownum</span><span class="p">)</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="n">pcs[</span><span class="m">-1</span><span class="n">]</span>
    <span class="n">demodfpcs</span> <span class="o">&lt;-</span> <span class="nf">bind_cols</span><span class="p">(</span><span class="n">df[rownums</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span><span class="n">real_demos</span><span class="p">)</span><span class="n">]</span><span class="p">,</span> <span class="n">pcs</span><span class="p">)</span>

    <span class="c1"># weighting by # of responses per respondent</span>
    <span class="n">resps_by_key</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span><span class="o">$</span><span class="n">key</span> <span class="o">%&gt;%</span> <span class="n">table</span> <span class="o">%&gt;%</span> <span class="n">as.data.frame</span>
    <span class="nf">names</span><span class="p">(</span><span class="n">resps_by_key</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span><span class="s">&#39;n&#39;</span><span class="p">)</span>
    <span class="n">resps_by_key</span> <span class="o">%&lt;&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">n</span><span class="o">!=</span><span class="m">0</span><span class="p">)</span>
    <span class="nf">for</span><span class="p">(</span><span class="n">r</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">)))</span> <span class="p">{</span>
        <span class="n">nresps</span> <span class="o">&lt;-</span> <span class="n">resps_by_key</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">demodfpcs[r</span><span class="p">,</span><span class="n">]</span><span class="o">$</span><span class="n">key</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">.$n</span>
        <span class="n">demodfpcs[r</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">,</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">)))</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="n">nresps</span><span class="p">)</span> <span class="o">*</span>
                                                        <span class="p">(</span><span class="n">demodfpcs[r</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">,</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">)))</span><span class="n">]</span><span class="p">)</span>
    <span class="p">}</span>
                                       
    <span class="c1"># separate PCs and demographics</span>
    <span class="n">demodfpcs</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="s">&#39;key&#39;</span><span class="p">)</span>
    <span class="n">demodf</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">))</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">))</span>

                  
    <span class="c1"># plotting (by PC)</span>
    <span class="nf">for</span><span class="p">(</span><span class="n">p</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="n">pcs</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1"># combine individual PC with demographics</span>
        <span class="n">temp</span> <span class="o">&lt;-</span> <span class="nf">bind_cols</span><span class="p">(</span><span class="n">pcs[p]</span><span class="p">,</span> <span class="n">demodf</span><span class="p">)</span>
        <span class="nf">names</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;pc&quot;</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="n">[</span><span class="m">-1</span><span class="n">]</span><span class="p">)</span>
        
        
        <span class="c1"># for each demographic...</span>
        <span class="nf">for</span><span class="p">(</span><span class="n">d</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="n">small_demos</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">mu</span> <span class="o">&lt;-</span> <span class="n">temp</span> <span class="o">%&gt;%</span> <span class="n">na.omit</span> <span class="o">%&gt;%</span> <span class="nf">group_by_at</span><span class="p">(</span><span class="nf">vars</span><span class="p">(</span><span class="n">small_demos[d]</span><span class="p">))</span> <span class="o">%&gt;%</span> 
                <span class="nf">summarise</span><span class="p">(</span><span class="n">grp.median</span><span class="o">=</span><span class="nf">median</span><span class="p">(</span><span class="n">pc</span><span class="p">),</span> <span class="n">grp.mean</span><span class="o">=</span><span class="nf">mean</span><span class="p">(</span><span class="n">pc</span><span class="p">),</span> <span class="n">grp.sd</span><span class="o">=</span><span class="nf">sd</span><span class="p">(</span><span class="n">pc</span><span class="p">))</span>
<span class="c1">#density plot</span>
               <span class="nf">ggplot</span><span class="p">(</span><span class="nf">na.omit</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">),</span> <span class="nf">aes_string</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nf">names</span><span class="p">(</span><span class="n">pcs</span><span class="p">)</span><span class="n">[p]</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">small_demos[d]</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">small_demos[d]</span><span class="p">))</span> <span class="o">+</span>
              <span class="c1">#  geom_density_ridges(position=&#39;identity&#39;, alpha=.2) +</span>
               <span class="nf">geom_density</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="s">&#39;identity&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="m">.2</span><span class="p">)</span> <span class="o">+</span>
                
   <span class="c1">#violin_plot         </span>
            <span class="c1">#g &lt;- ggplot(na.omit(demodfpcs), aes_string(x=names(pcs)[p], y=small_demos[d]))</span>
            <span class="c1">#g + geom_violin(scale=&quot;area&quot;) + </span>

                <span class="nf">xlim</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="nf">na.omit</span><span class="p">(</span><span class="n">pcs[[p]]</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">summary</span> <span class="o">%&gt;%</span> <span class="n">tidy</span> <span class="o">%&gt;%</span> <span class="n">.$minimum</span><span class="p">)</span><span class="m">-0.5</span><span class="p">,</span> 
                     <span class="nf">round</span><span class="p">(</span><span class="nf">na.omit</span><span class="p">(</span><span class="n">pcs[[p]]</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">summary</span> <span class="o">%&gt;%</span> <span class="n">tidy</span> <span class="o">%&gt;%</span> <span class="n">.$maximum</span><span class="p">)</span><span class="m">+.5</span><span class="p">)</span> <span class="o">+</span>
                <span class="nf">geom_vline</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span> <span class="nf">aes_string</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="s">&#39;grp.median&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="nf">names</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span><span class="n">[1]</span><span class="p">),</span>
                         <span class="n">linetype</span><span class="o">=</span><span class="s">&quot;dashed&quot;</span><span class="p">)</span> <span class="o">+</span>
                <span class="nf">labs</span><span class="p">(</span><span class="n">subtitle</span><span class="o">=</span><span class="nf">paste0</span><span class="p">(</span><span class="s">&#39;pos-x: &#39;</span><span class="p">,</span> <span class="n">pca_labels</span> <span class="o">%&gt;%</span> 
                      <span class="nf">filter</span><span class="p">(</span><span class="n">question_name</span><span class="o">==</span><span class="n">question</span><span class="p">)</span> <span class="o">%&gt;%</span> 
                      <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;_pos&#39;</span><span class="p">)))</span> <span class="o">%&gt;%</span>
                      <span class="n">pull</span> <span class="o">%&gt;%</span> <span class="n">as.character</span><span class="p">,</span>
                     <span class="s">&#39;\nneg-x: &#39;</span><span class="p">,</span> <span class="n">pca_labels</span> <span class="o">%&gt;%</span> 
                      <span class="nf">filter</span><span class="p">(</span><span class="n">question_name</span><span class="o">==</span><span class="n">question</span><span class="p">)</span> <span class="o">%&gt;%</span> 
                      <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;_neg&#39;</span><span class="p">)))</span> <span class="o">%&gt;%</span>
                      <span class="n">pull</span> <span class="o">%&gt;%</span> <span class="n">as.character</span><span class="p">))</span> <span class="o">+</span>
                <span class="nf">theme</span><span class="p">(</span><span class="n">plot.subtitle</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">10</span><span class="p">))</span>

            <span class="c1"># saving</span>
            <span class="nf">dir.create</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">dir_to_save_results</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="n">pcs</span><span class="p">)</span><span class="n">[p]</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&#39;/&#39;</span><span class="p">),</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
            <span class="nf">dir.create</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">dir_to_save_results</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="n">pcs</span><span class="p">)</span><span class="n">[p]</span><span class="p">,</span> <span class="n">plot_type</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&#39;/&#39;</span><span class="p">),</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
            <span class="nf">ggsave</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">dir_to_save_results</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="n">pcs</span><span class="p">)</span><span class="n">[p]</span><span class="p">,</span> <span class="n">plot_type</span><span class="p">,</span> 
                         <span class="nf">paste0</span><span class="p">(</span><span class="n">small_demos[d]</span><span class="p">,</span> <span class="n">output_format</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&#39;/&#39;</span><span class="p">),</span> 
                   <span class="n">width</span> <span class="o">=</span> <span class="m">6</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="m">5</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
Warning message:
“Groups with fewer than two data points have been dropped.”
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="nf">names</span><span class="p">(</span><span class="n">pcs</span><span class="p">)</span><span class="n">[p]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea ">
'PC5'
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">summaryValues</span><span class="p">,</span><span class="nf">aes</span><span class="p">(</span><span class="nf">factor</span><span class="p">(</span><span class="n">Discipline</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pointEst</span> <span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="n">minCI</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">maxCI</span><span class="p">,</span>
          <span class="n">color</span><span class="o">=</span><span class="nf">factor</span><span class="p">(</span><span class="n">Discipline</span><span class="p">),</span> <span class="n">shape</span><span class="o">=</span><span class="nf">factor</span><span class="p">(</span><span class="n">SigEff</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;Not Sig.&quot;</span><span class="p">,</span> <span class="s">&quot;p &lt;= .05&quot;</span><span class="p">))))</span> <span class="o">+</span>
          <span class="nf">geom_pointrange</span><span class="p">()</span> <span class="o">+</span> <span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">Topic</span><span class="p">,</span> <span class="n">shrink</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">as.table</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">labeller</span> <span class="o">=</span> <span class="n">topic_labels_panel</span><span class="p">)</span> <span class="o">+</span> 
          <span class="nf">theme</span><span class="p">(</span><span class="n">legend.justification</span> <span class="o">=</span> <span class="s">&quot;top&quot;</span><span class="p">,</span> <span class="n">axis.title.x</span><span class="o">=</span><span class="nf">element_blank</span><span class="p">(),</span> <span class="n">axis.text.x</span><span class="o">=</span><span class="nf">element_blank</span><span class="p">(),</span> <span class="n">axis.ticks.x</span><span class="o">=</span><span class="nf">element_blank</span><span class="p">())</span> <span class="o">+</span> 
           <span class="nf">scale_colour_manual</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Primary Discipline&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">a2ru</span><span class="p">)</span> <span class="o">+</span> <span class="nf">scale_shape_manual</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Significant Difference?&quot;</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">19</span><span class="p">,</span><span class="m">8</span><span class="p">))</span> <span class="o">+</span> <span class="nf">labs</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="s">&quot;Proportion&quot;</span><span class="p">)</span> <span class="o">+</span>
           <span class="nf">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Topical Prevalence Plot across Different Topics&quot;</span><span class="p">)</span> 
    <span class="nf">ggsave</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">folder_id</span><span class="p">,</span> <span class="n">q_id</span><span class="p">,</span> <span class="s">&quot;TopicPrevByTopic.pdf&quot;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">height</span><span class="p">,</span> <span class="n">useDingbats</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
Error in ggplot(summaryValues, aes(factor(Discipline), y = pointEst, ymin = minCI, : object &#39;summaryValues&#39; not found
Traceback:

1. ggplot(summaryValues, aes(factor(Discipline), y = pointEst, ymin = minCI, 
 .     ymax = maxCI, color = factor(Discipline), shape = factor(SigEff, 
 .         labels = c(&#34;Not Sig.&#34;, &#34;p &lt;= .05&#34;))))</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">small_demos</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<ol class=list-inline>
	<li>'ethnic_group'</li>
	<li>'sex'</li>
	<li>'school'</li>
	<li>'parented'</li>
	<li>'income'</li>
	<li>'artsincollege'</li>
	<li>'hstype'</li>
	<li>'hssize'</li>
	<li>'hslocation'</li>
	<li>'hs_arts_freq'</li>
	<li>'hs_encouragement'</li>
	<li>'hs_required'</li>
	<li>'hs_fees'</li>
	<li>'so_childhood1'</li>
	<li>'so_childhood3'</li>
	<li>'so_childhood5'</li>
	<li>'sr_participated'</li>
	<li>'sr_highestdegreeplanned'</li>
</ol>

</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">plotdata</span> <span class="o">&lt;-</span> <span class="nf">melt</span><span class="p">(</span><span class="nf">na.omit</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Using key, ethnic_group, sex, school, parented, income, artsincollege, hstype, hssize, hslocation, hs_arts_freq, hs_encouragement, hs_required, hs_fees, so_childhood1, so_childhood3, so_childhood5, sr_participated, sr_highestdegreeplanned as id variables
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">reshapedata</span> <span class="o">&lt;-</span> <span class="nf">melt</span><span class="p">(</span><span class="n">pcs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>No id variables; using all as measure variables
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="nf">names</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<ol class=list-inline>
	<li>'pc'</li>
	<li>'ethnic_group'</li>
	<li>'sex'</li>
	<li>'school'</li>
	<li>'parented'</li>
	<li>'income'</li>
	<li>'artsincollege'</li>
	<li>'hstype'</li>
	<li>'hssize'</li>
	<li>'hslocation'</li>
	<li>'hs_arts_freq'</li>
	<li>'hs_encouragement'</li>
	<li>'hs_required'</li>
	<li>'hs_fees'</li>
	<li>'so_childhood1'</li>
	<li>'so_childhood3'</li>
	<li>'so_childhood5'</li>
	<li>'sr_participated'</li>
	<li>'sr_highestdegreeplanned'</li>
</ol>

</div>

</div>
</div>
</div>
</div>

</div>
</div>

 


    </main>
    